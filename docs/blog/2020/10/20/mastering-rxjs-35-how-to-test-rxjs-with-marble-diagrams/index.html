<!DOCTYPE html><html lang="en"><head>
  <meta charset="utf-8">
  <title>[RxJS] 如何替 RxJS 撰寫測試 - 一般測試與彈珠圖測試方法 | 全端開發人員天梯</title>
  <base href="/">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" type="image/x-icon" href="favicon.ico">
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <style type="text/css">@font-face{font-family:'Roboto';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOlCnqEu92Fr1MmSU5fCRc4AMP6lbBP.woff2) format('woff2');unicode-range:U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;}@font-face{font-family:'Roboto';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOlCnqEu92Fr1MmSU5fABc4AMP6lbBP.woff2) format('woff2');unicode-range:U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;}@font-face{font-family:'Roboto';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOlCnqEu92Fr1MmSU5fCBc4AMP6lbBP.woff2) format('woff2');unicode-range:U+1F00-1FFF;}@font-face{font-family:'Roboto';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOlCnqEu92Fr1MmSU5fBxc4AMP6lbBP.woff2) format('woff2');unicode-range:U+0370-03FF;}@font-face{font-family:'Roboto';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOlCnqEu92Fr1MmSU5fCxc4AMP6lbBP.woff2) format('woff2');unicode-range:U+0102-0103, U+0110-0111, U+0128-0129, U+0168-0169, U+01A0-01A1, U+01AF-01B0, U+1EA0-1EF9, U+20AB;}@font-face{font-family:'Roboto';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOlCnqEu92Fr1MmSU5fChc4AMP6lbBP.woff2) format('woff2');unicode-range:U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;}@font-face{font-family:'Roboto';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOlCnqEu92Fr1MmSU5fBBc4AMP6lQ.woff2) format('woff2');unicode-range:U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;}@font-face{font-family:'Roboto';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOmCnqEu92Fr1Mu72xKKTU1Kvnz.woff2) format('woff2');unicode-range:U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;}@font-face{font-family:'Roboto';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOmCnqEu92Fr1Mu5mxKKTU1Kvnz.woff2) format('woff2');unicode-range:U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;}@font-face{font-family:'Roboto';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOmCnqEu92Fr1Mu7mxKKTU1Kvnz.woff2) format('woff2');unicode-range:U+1F00-1FFF;}@font-face{font-family:'Roboto';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOmCnqEu92Fr1Mu4WxKKTU1Kvnz.woff2) format('woff2');unicode-range:U+0370-03FF;}@font-face{font-family:'Roboto';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOmCnqEu92Fr1Mu7WxKKTU1Kvnz.woff2) format('woff2');unicode-range:U+0102-0103, U+0110-0111, U+0128-0129, U+0168-0169, U+01A0-01A1, U+01AF-01B0, U+1EA0-1EF9, U+20AB;}@font-face{font-family:'Roboto';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOmCnqEu92Fr1Mu7GxKKTU1Kvnz.woff2) format('woff2');unicode-range:U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;}@font-face{font-family:'Roboto';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOmCnqEu92Fr1Mu4mxKKTU1Kg.woff2) format('woff2');unicode-range:U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;}@font-face{font-family:'Roboto';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOlCnqEu92Fr1MmEU9fCRc4AMP6lbBP.woff2) format('woff2');unicode-range:U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;}@font-face{font-family:'Roboto';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOlCnqEu92Fr1MmEU9fABc4AMP6lbBP.woff2) format('woff2');unicode-range:U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;}@font-face{font-family:'Roboto';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOlCnqEu92Fr1MmEU9fCBc4AMP6lbBP.woff2) format('woff2');unicode-range:U+1F00-1FFF;}@font-face{font-family:'Roboto';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOlCnqEu92Fr1MmEU9fBxc4AMP6lbBP.woff2) format('woff2');unicode-range:U+0370-03FF;}@font-face{font-family:'Roboto';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOlCnqEu92Fr1MmEU9fCxc4AMP6lbBP.woff2) format('woff2');unicode-range:U+0102-0103, U+0110-0111, U+0128-0129, U+0168-0169, U+01A0-01A1, U+01AF-01B0, U+1EA0-1EF9, U+20AB;}@font-face{font-family:'Roboto';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOlCnqEu92Fr1MmEU9fChc4AMP6lbBP.woff2) format('woff2');unicode-range:U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;}@font-face{font-family:'Roboto';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v29/KFOlCnqEu92Fr1MmEU9fBBc4AMP6lQ.woff2) format('woff2');unicode-range:U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;}</style>
  <style type="text/css">@font-face{font-family:'Lato';font-style:italic;font-weight:300;src:url(https://fonts.gstatic.com/s/lato/v20/S6u_w4BMUTPHjxsI9w2_FQftx9897sxZ.woff2) format('woff2');unicode-range:U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;}@font-face{font-family:'Lato';font-style:italic;font-weight:300;src:url(https://fonts.gstatic.com/s/lato/v20/S6u_w4BMUTPHjxsI9w2_Gwftx9897g.woff2) format('woff2');unicode-range:U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;}@font-face{font-family:'Lato';font-style:italic;font-weight:400;src:url(https://fonts.gstatic.com/s/lato/v20/S6u8w4BMUTPHjxsAUi-qNiXg7eU0.woff2) format('woff2');unicode-range:U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;}@font-face{font-family:'Lato';font-style:italic;font-weight:400;src:url(https://fonts.gstatic.com/s/lato/v20/S6u8w4BMUTPHjxsAXC-qNiXg7Q.woff2) format('woff2');unicode-range:U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;}@font-face{font-family:'Lato';font-style:italic;font-weight:700;src:url(https://fonts.gstatic.com/s/lato/v20/S6u_w4BMUTPHjxsI5wq_FQftx9897sxZ.woff2) format('woff2');unicode-range:U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;}@font-face{font-family:'Lato';font-style:italic;font-weight:700;src:url(https://fonts.gstatic.com/s/lato/v20/S6u_w4BMUTPHjxsI5wq_Gwftx9897g.woff2) format('woff2');unicode-range:U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;}@font-face{font-family:'Lato';font-style:normal;font-weight:300;src:url(https://fonts.gstatic.com/s/lato/v20/S6u9w4BMUTPHh7USSwaPGQ3q5d0N7w.woff2) format('woff2');unicode-range:U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;}@font-face{font-family:'Lato';font-style:normal;font-weight:300;src:url(https://fonts.gstatic.com/s/lato/v20/S6u9w4BMUTPHh7USSwiPGQ3q5d0.woff2) format('woff2');unicode-range:U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;}@font-face{font-family:'Lato';font-style:normal;font-weight:400;src:url(https://fonts.gstatic.com/s/lato/v20/S6uyw4BMUTPHjxAwXiWtFCfQ7A.woff2) format('woff2');unicode-range:U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;}@font-face{font-family:'Lato';font-style:normal;font-weight:400;src:url(https://fonts.gstatic.com/s/lato/v20/S6uyw4BMUTPHjx4wXiWtFCc.woff2) format('woff2');unicode-range:U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;}@font-face{font-family:'Lato';font-style:normal;font-weight:700;src:url(https://fonts.gstatic.com/s/lato/v20/S6u9w4BMUTPHh6UVSwaPGQ3q5d0N7w.woff2) format('woff2');unicode-range:U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;}@font-face{font-family:'Lato';font-style:normal;font-weight:700;src:url(https://fonts.gstatic.com/s/lato/v20/S6u9w4BMUTPHh6UVSwiPGQ3q5d0.woff2) format('woff2');unicode-range:U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;}</style>
  <style type="text/css">@font-face{font-family:'Material Icons';font-style:normal;font-weight:400;src:url(https://fonts.gstatic.com/s/materialicons/v111/flUhRq6tzZclQEJ-Vdg-IuiaDsNcIhQ8tQ.woff2) format('woff2');}.material-icons{font-family:'Material Icons';font-weight:normal;font-style:normal;font-size:24px;line-height:1;letter-spacing:normal;text-transform:none;display:inline-block;white-space:nowrap;word-wrap:normal;direction:ltr;-webkit-font-feature-settings:'liga';-webkit-font-smoothing:antialiased;}</style>
  <script src="https://kit.fontawesome.com/1792a2a12b.js" crossorigin="anonymous"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.3.1/styles/github.min.css" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.3.1/highlight.min.js"></script>
  <script async="" defer="" crossorigin="anonymous" src="https://connect.facebook.net/zh_TW/sdk.js#xfbml=1&amp;version=v3.3&amp;appId=1148471878668114&amp;autoLogAppEvents=1"></script>
<style>body,html{height:100%;background:#fafafa;}body{margin:0;font-family:Roboto,loto,noto sans tc,microsoft yahei,sans-serif;}</style><style>.mat-fab,.mat-icon-button{font-family:Roboto,Helvetica Neue,sans-serif;font-size:14px;font-weight:500;}.mat-chip{font-size:14px;font-weight:500;}.mat-toolbar,.mat-toolbar h1{font:500 20px/32px Roboto,Helvetica Neue,sans-serif;letter-spacing:normal;margin:0;}.mat-list-item{font-family:Roboto,Helvetica Neue,sans-serif;}.mat-list-base .mat-list-item{font-size:16px;}.mat-ripple{overflow:hidden;position:relative;}.mat-ripple:not(:empty){transform:translateZ(0);}.cdk-visually-hidden{border:0;clip:rect(0 0 0 0);height:1px;margin:-1px;overflow:hidden;padding:0;position:absolute;width:1px;white-space:nowrap;outline:0;-webkit-appearance:none;-moz-appearance:none;}.mat-focus-indicator{position:relative;}.mat-elevation-z6{box-shadow:0 3px 5px -1px #0003,0 6px 10px 0 #00000024,0 1px 18px 0 #0000001f;}.mat-icon-button{color:inherit;background:#0000;}.mat-button-focus-overlay{background:#000;}.mat-fab{color:#000000de;background-color:#fff;}.mat-fab:not([class*=mat-elevation-z]){box-shadow:0 3px 5px -1px #0003,0 6px 10px 0 #00000024,0 1px 18px 0 #0000001f;}.mat-fab:not(.mat-button-disabled):active:not([class*=mat-elevation-z]){box-shadow:0 7px 8px -4px #0003,0 12px 17px 2px #00000024,0 5px 22px 4px #0000001f;}.mat-chip.mat-standard-chip{background-color:#e0e0e0;color:#000000de;}.mat-chip.mat-standard-chip:not(.mat-chip-disabled):active{box-shadow:0 3px 3px -2px #0003,0 3px 4px 0 #00000024,0 1px 8px 0 #0000001f;}.mat-chip.mat-standard-chip:after{background:#000;}.mat-chip.mat-standard-chip.mat-chip-selected.mat-primary{background-color:#3f51b5;color:#fff;}.mat-divider{border-top-color:#0000001f;}.mat-list-base .mat-list-item{color:#000000de;}.mat-nav-list .mat-list-item:focus,.mat-nav-list .mat-list-item:hover{background:#0000000a;}.mat-drawer-container{background-color:#fafafa;color:#000000de;}.mat-drawer{color:#000000de;}.mat-drawer{background-color:#fff;}.mat-drawer-side{border-right:1px solid #0000001f;}.mat-toolbar{background:#f5f5f5;color:#000000de;}.mat-toolbar.mat-primary{background:#3f51b5;color:#fff;}.mat-toolbar-single-row{height:64px;}@media (max-width: 599px){.mat-toolbar-single-row{height:56px;}}body,html{height:100%;background:#fafafa;}body{margin:0;font-family:Roboto,loto,noto sans tc,microsoft yahei,sans-serif;}a{color:#5c6bc0;transition:all .3s;}a,a:hover{text-decoration:underline;}a:hover{color:#3949ab;}a:active{color:#5c6bc0;}.blog-post{margin-bottom:16px;}.blog-post .blog-post-subtitle{display:flex;align-items:center;font-size:14px;}.blog-post .blog-post-subtitle .sub-divider{margin:0 8px;}.blog-post .blog-post-subtitle .mat-icon{margin-right:8px;position:relative;top:-2px;}.blog-post .blog-post-subtitle .blog-post-published{line-height:24px;display:inline-flex;flex-direction:row;align-items:center;}.blog-post .blog-post-subtitle .blog-post-categories{margin-left:8px;line-height:24px;display:inline-flex;}.blog-post .blog-post-subtitle .blog-post-categories .blog-post-category-link{font-weight:500;}.blog-post .blog-post{font-size:16px;line-height:24px;color:#212121;}.blog-post{font-size:16px;line-height:24px;}.blog-post pre{font-size:14px;line-height:21px;background:#eee;border:.5px solid #0003;border-radius:5px;display:block;margin:16px auto;overflow-x:auto;white-space:pre-wrap;}.blog-post code{background:#eee;border-radius:3px;padding:3px;}.blog-post .note{background:#0000;border:.5px solid #0003;border-radius:3px;padding:1em;}.blog-post .note p:first-child{margin-block-start:0;}.blog-post .note p:last-child{margin-block-end:0;}.blog-post .note.info{border-left:5px solid #3f51b5;}.blog-post-tags{display:flex;justify-content:center;}.blog-post-tags .blog-post-tag{cursor:pointer;}</style><link rel="stylesheet" href="styles.876ba2c12bf128be887b.css" media="print" onload="this.media='all'"><noscript><link rel="stylesheet" href="styles.876ba2c12bf128be887b.css"></noscript><style ng-transition="serverApp">.toolbar[_ngcontent-sc86]{position:fixed;z-index:10}.toolbar[_ngcontent-sc86]   a.header-link[_ngcontent-sc86]{text-decoration:none}.toolbar[_ngcontent-sc86]   a.header-link[_ngcontent-sc86]   .header-link-1[_ngcontent-sc86]{color:#fff}.toolbar[_ngcontent-sc86]   a.header-link[_ngcontent-sc86]   .header-link-1[_ngcontent-sc86]:hover, .toolbar[_ngcontent-sc86]   a.header-link[_ngcontent-sc86]   .header-link-1[_ngcontent-sc86]:active{color:#fff}.toolbar[_ngcontent-sc86]   a.header-link[_ngcontent-sc86]   .header-link-2[_ngcontent-sc86]{color:#fff}.toolbar[_ngcontent-sc86]   a.header-link[_ngcontent-sc86]   .header-link-2[_ngcontent-sc86]:hover, .toolbar[_ngcontent-sc86]   a.header-link[_ngcontent-sc86]   .header-link-2[_ngcontent-sc86]:active{color:#fff}.drawer-container[_ngcontent-sc86]{top:64px;height:calc(100vh - 64px)}  .mat-drawer-inner-container::-webkit-scrollbar{height:4px;width:4px}  .mat-drawer-inner-container::-webkit-scrollbar-thumb{background:rgba(0,0,0,.26)}.sidebar[_ngcontent-sc86]{min-width:240px;max-width:240px}.sidebar[_ngcontent-sc86]   .section-title[_ngcontent-sc86]{color:#757575;font-size:20px;padding-left:16px}.sidebar[_ngcontent-sc86]   .section-content[_ngcontent-sc86]{color:#757575;text-align:center}.sidebar[_ngcontent-sc86]   .mat-divider[_ngcontent-sc86]{margin:4px 0}.sidebar[_ngcontent-sc86]   .post-statics[_ngcontent-sc86]{padding:16px;display:flex}.sidebar[_ngcontent-sc86]   .post-statics[_ngcontent-sc86]   .statics-block[_ngcontent-sc86]{flex:33%;display:flex;flex-direction:column}.sidebar[_ngcontent-sc86]   .post-statics[_ngcontent-sc86]   .statics-block[_ngcontent-sc86]   a[_ngcontent-sc86]{text-decoration:none}.sidebar[_ngcontent-sc86]   .post-statics[_ngcontent-sc86]   .statics-block[_ngcontent-sc86]   .counter[_ngcontent-sc86]{color:#3f51b5;font-size:24px;text-align:center}.sidebar[_ngcontent-sc86]   .post-statics[_ngcontent-sc86]   .statics-block[_ngcontent-sc86]   .description[_ngcontent-sc86]{color:#757575;font-size:16px;text-align:center}.sidebar[_ngcontent-sc86]   .mat-list-item[_ngcontent-sc86]{color:#757575}.sidebar[_ngcontent-sc86]   .mat-list-item[_ngcontent-sc86]   .mat-icon[_ngcontent-sc86]{padding-right:8px;display:flex;align-items:center;justify-content:center}.sidebar[_ngcontent-sc86]   .mat-list-item[_ngcontent-sc86]   .mat-icon.fab[_ngcontent-sc86]{font-size:20px}.sidebar[_ngcontent-sc86]   .mat-list-item.active[_ngcontent-sc86]{color:#3f51b5;background:rgba(63,81,181,.15)}.main-content.server[_ngcontent-sc86]{margin-left:240px}</style><style ng-transition="serverApp">.cdk-high-contrast-active .mat-toolbar{outline:solid 1px}.mat-toolbar-row,.mat-toolbar-single-row{display:flex;box-sizing:border-box;padding:0 16px;width:100%;flex-direction:row;align-items:center;white-space:nowrap}.mat-toolbar-multiple-rows{display:flex;box-sizing:border-box;flex-direction:column;width:100%}
</style><style ng-transition="serverApp">.mat-button .mat-button-focus-overlay,.mat-icon-button .mat-button-focus-overlay{opacity:0}.mat-button:hover:not(.mat-button-disabled) .mat-button-focus-overlay,.mat-stroked-button:hover:not(.mat-button-disabled) .mat-button-focus-overlay{opacity:.04}@media(hover: none){.mat-button:hover:not(.mat-button-disabled) .mat-button-focus-overlay,.mat-stroked-button:hover:not(.mat-button-disabled) .mat-button-focus-overlay{opacity:0}}.mat-button,.mat-icon-button,.mat-stroked-button,.mat-flat-button{box-sizing:border-box;position:relative;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;cursor:pointer;outline:none;border:none;-webkit-tap-highlight-color:transparent;display:inline-block;white-space:nowrap;text-decoration:none;vertical-align:baseline;text-align:center;margin:0;min-width:64px;line-height:36px;padding:0 16px;border-radius:4px;overflow:visible}.mat-button::-moz-focus-inner,.mat-icon-button::-moz-focus-inner,.mat-stroked-button::-moz-focus-inner,.mat-flat-button::-moz-focus-inner{border:0}.mat-button.mat-button-disabled,.mat-icon-button.mat-button-disabled,.mat-stroked-button.mat-button-disabled,.mat-flat-button.mat-button-disabled{cursor:default}.mat-button.cdk-keyboard-focused .mat-button-focus-overlay,.mat-button.cdk-program-focused .mat-button-focus-overlay,.mat-icon-button.cdk-keyboard-focused .mat-button-focus-overlay,.mat-icon-button.cdk-program-focused .mat-button-focus-overlay,.mat-stroked-button.cdk-keyboard-focused .mat-button-focus-overlay,.mat-stroked-button.cdk-program-focused .mat-button-focus-overlay,.mat-flat-button.cdk-keyboard-focused .mat-button-focus-overlay,.mat-flat-button.cdk-program-focused .mat-button-focus-overlay{opacity:.12}.mat-button::-moz-focus-inner,.mat-icon-button::-moz-focus-inner,.mat-stroked-button::-moz-focus-inner,.mat-flat-button::-moz-focus-inner{border:0}.mat-raised-button{box-sizing:border-box;position:relative;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;cursor:pointer;outline:none;border:none;-webkit-tap-highlight-color:transparent;display:inline-block;white-space:nowrap;text-decoration:none;vertical-align:baseline;text-align:center;margin:0;min-width:64px;line-height:36px;padding:0 16px;border-radius:4px;overflow:visible;transform:translate3d(0, 0, 0);transition:background 400ms cubic-bezier(0.25, 0.8, 0.25, 1),box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1)}.mat-raised-button::-moz-focus-inner{border:0}.mat-raised-button.mat-button-disabled{cursor:default}.mat-raised-button.cdk-keyboard-focused .mat-button-focus-overlay,.mat-raised-button.cdk-program-focused .mat-button-focus-overlay{opacity:.12}.mat-raised-button::-moz-focus-inner{border:0}._mat-animation-noopable.mat-raised-button{transition:none;animation:none}.mat-stroked-button{border:1px solid currentColor;padding:0 15px;line-height:34px}.mat-stroked-button .mat-button-ripple.mat-ripple,.mat-stroked-button .mat-button-focus-overlay{top:-1px;left:-1px;right:-1px;bottom:-1px}.mat-fab{box-sizing:border-box;position:relative;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;cursor:pointer;outline:none;border:none;-webkit-tap-highlight-color:transparent;display:inline-block;white-space:nowrap;text-decoration:none;vertical-align:baseline;text-align:center;margin:0;min-width:64px;line-height:36px;padding:0 16px;border-radius:4px;overflow:visible;transform:translate3d(0, 0, 0);transition:background 400ms cubic-bezier(0.25, 0.8, 0.25, 1),box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1);min-width:0;border-radius:50%;width:56px;height:56px;padding:0;flex-shrink:0}.mat-fab::-moz-focus-inner{border:0}.mat-fab.mat-button-disabled{cursor:default}.mat-fab.cdk-keyboard-focused .mat-button-focus-overlay,.mat-fab.cdk-program-focused .mat-button-focus-overlay{opacity:.12}.mat-fab::-moz-focus-inner{border:0}._mat-animation-noopable.mat-fab{transition:none;animation:none}.mat-fab .mat-button-wrapper{padding:16px 0;display:inline-block;line-height:24px}.mat-mini-fab{box-sizing:border-box;position:relative;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;cursor:pointer;outline:none;border:none;-webkit-tap-highlight-color:transparent;display:inline-block;white-space:nowrap;text-decoration:none;vertical-align:baseline;text-align:center;margin:0;min-width:64px;line-height:36px;padding:0 16px;border-radius:4px;overflow:visible;transform:translate3d(0, 0, 0);transition:background 400ms cubic-bezier(0.25, 0.8, 0.25, 1),box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1);min-width:0;border-radius:50%;width:40px;height:40px;padding:0;flex-shrink:0}.mat-mini-fab::-moz-focus-inner{border:0}.mat-mini-fab.mat-button-disabled{cursor:default}.mat-mini-fab.cdk-keyboard-focused .mat-button-focus-overlay,.mat-mini-fab.cdk-program-focused .mat-button-focus-overlay{opacity:.12}.mat-mini-fab::-moz-focus-inner{border:0}._mat-animation-noopable.mat-mini-fab{transition:none;animation:none}.mat-mini-fab .mat-button-wrapper{padding:8px 0;display:inline-block;line-height:24px}.mat-icon-button{padding:0;min-width:0;width:40px;height:40px;flex-shrink:0;line-height:40px;border-radius:50%}.mat-icon-button i,.mat-icon-button .mat-icon{line-height:24px}.mat-button-ripple.mat-ripple,.mat-button-focus-overlay{top:0;left:0;right:0;bottom:0;position:absolute;pointer-events:none;border-radius:inherit}.mat-button-ripple.mat-ripple:not(:empty){transform:translateZ(0)}.mat-button-focus-overlay{opacity:0;transition:opacity 200ms cubic-bezier(0.35, 0, 0.25, 1),background-color 200ms cubic-bezier(0.35, 0, 0.25, 1)}._mat-animation-noopable .mat-button-focus-overlay{transition:none}.mat-button-ripple-round{border-radius:50%;z-index:1}.mat-button .mat-button-wrapper>*,.mat-flat-button .mat-button-wrapper>*,.mat-stroked-button .mat-button-wrapper>*,.mat-raised-button .mat-button-wrapper>*,.mat-icon-button .mat-button-wrapper>*,.mat-fab .mat-button-wrapper>*,.mat-mini-fab .mat-button-wrapper>*{vertical-align:middle}.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-prefix .mat-icon-button,.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-suffix .mat-icon-button{display:inline-flex;justify-content:center;align-items:center;font-size:inherit;width:2.5em;height:2.5em}.cdk-high-contrast-active .mat-button,.cdk-high-contrast-active .mat-flat-button,.cdk-high-contrast-active .mat-raised-button,.cdk-high-contrast-active .mat-icon-button,.cdk-high-contrast-active .mat-fab,.cdk-high-contrast-active .mat-mini-fab{outline:solid 1px}.cdk-high-contrast-active .mat-button-base.cdk-keyboard-focused,.cdk-high-contrast-active .mat-button-base.cdk-program-focused{outline:solid 3px}
</style><style ng-transition="serverApp">.mat-drawer-container{position:relative;z-index:1;box-sizing:border-box;-webkit-overflow-scrolling:touch;display:block;overflow:hidden}.mat-drawer-container[fullscreen]{top:0;left:0;right:0;bottom:0;position:absolute}.mat-drawer-container[fullscreen].mat-drawer-container-has-open{overflow:hidden}.mat-drawer-container.mat-drawer-container-explicit-backdrop .mat-drawer-side{z-index:3}.mat-drawer-container.ng-animate-disabled .mat-drawer-backdrop,.mat-drawer-container.ng-animate-disabled .mat-drawer-content,.ng-animate-disabled .mat-drawer-container .mat-drawer-backdrop,.ng-animate-disabled .mat-drawer-container .mat-drawer-content{transition:none}.mat-drawer-backdrop{top:0;left:0;right:0;bottom:0;position:absolute;display:block;z-index:3;visibility:hidden}.mat-drawer-backdrop.mat-drawer-shown{visibility:visible}.mat-drawer-transition .mat-drawer-backdrop{transition-duration:400ms;transition-timing-function:cubic-bezier(0.25, 0.8, 0.25, 1);transition-property:background-color,visibility}.cdk-high-contrast-active .mat-drawer-backdrop{opacity:.5}.mat-drawer-content{position:relative;z-index:1;display:block;height:100%;overflow:auto}.mat-drawer-transition .mat-drawer-content{transition-duration:400ms;transition-timing-function:cubic-bezier(0.25, 0.8, 0.25, 1);transition-property:transform,margin-left,margin-right}.mat-drawer{position:relative;z-index:4;display:block;position:absolute;top:0;bottom:0;z-index:3;outline:0;box-sizing:border-box;overflow-y:auto;transform:translate3d(-100%, 0, 0)}.cdk-high-contrast-active .mat-drawer,.cdk-high-contrast-active [dir=rtl] .mat-drawer.mat-drawer-end{border-right:solid 1px currentColor}.cdk-high-contrast-active [dir=rtl] .mat-drawer,.cdk-high-contrast-active .mat-drawer.mat-drawer-end{border-left:solid 1px currentColor;border-right:none}.mat-drawer.mat-drawer-side{z-index:2}.mat-drawer.mat-drawer-end{right:0;transform:translate3d(100%, 0, 0)}[dir=rtl] .mat-drawer{transform:translate3d(100%, 0, 0)}[dir=rtl] .mat-drawer.mat-drawer-end{left:0;right:auto;transform:translate3d(-100%, 0, 0)}.mat-drawer-inner-container{width:100%;height:100%;overflow:auto;-webkit-overflow-scrolling:touch}.mat-sidenav-fixed{position:fixed}
</style><style ng-transition="serverApp">.mat-divider{display:block;margin:0;border-top-width:1px;border-top-style:solid}.mat-divider.mat-divider-vertical{border-top:0;border-right-width:1px;border-right-style:solid}.mat-divider.mat-divider-inset{margin-left:80px}[dir=rtl] .mat-divider.mat-divider-inset{margin-left:auto;margin-right:80px}
</style><style ng-transition="serverApp">.mat-subheader{display:flex;box-sizing:border-box;padding:16px;align-items:center}.mat-list-base .mat-subheader{margin:0}.mat-list-base{padding-top:8px;display:block;-webkit-tap-highlight-color:transparent}.mat-list-base .mat-subheader{height:48px;line-height:16px}.mat-list-base .mat-subheader:first-child{margin-top:-8px}.mat-list-base .mat-list-item,.mat-list-base .mat-list-option{display:block;height:48px;-webkit-tap-highlight-color:transparent;width:100%;padding:0}.mat-list-base .mat-list-item .mat-list-item-content,.mat-list-base .mat-list-option .mat-list-item-content{display:flex;flex-direction:row;align-items:center;box-sizing:border-box;padding:0 16px;position:relative;height:inherit}.mat-list-base .mat-list-item .mat-list-item-content-reverse,.mat-list-base .mat-list-option .mat-list-item-content-reverse{display:flex;align-items:center;padding:0 16px;flex-direction:row-reverse;justify-content:space-around}.mat-list-base .mat-list-item .mat-list-item-ripple,.mat-list-base .mat-list-option .mat-list-item-ripple{top:0;left:0;right:0;bottom:0;position:absolute;pointer-events:none}.mat-list-base .mat-list-item.mat-list-item-with-avatar,.mat-list-base .mat-list-option.mat-list-item-with-avatar{height:56px}.mat-list-base .mat-list-item.mat-2-line,.mat-list-base .mat-list-option.mat-2-line{height:72px}.mat-list-base .mat-list-item.mat-3-line,.mat-list-base .mat-list-option.mat-3-line{height:88px}.mat-list-base .mat-list-item.mat-multi-line,.mat-list-base .mat-list-option.mat-multi-line{height:auto}.mat-list-base .mat-list-item.mat-multi-line .mat-list-item-content,.mat-list-base .mat-list-option.mat-multi-line .mat-list-item-content{padding-top:16px;padding-bottom:16px}.mat-list-base .mat-list-item .mat-list-text,.mat-list-base .mat-list-option .mat-list-text{display:flex;flex-direction:column;flex:auto;box-sizing:border-box;overflow:hidden;padding:0}.mat-list-base .mat-list-item .mat-list-text>*,.mat-list-base .mat-list-option .mat-list-text>*{margin:0;padding:0;font-weight:normal;font-size:inherit}.mat-list-base .mat-list-item .mat-list-text:empty,.mat-list-base .mat-list-option .mat-list-text:empty{display:none}.mat-list-base .mat-list-item.mat-list-item-with-avatar .mat-list-item-content .mat-list-text,.mat-list-base .mat-list-item.mat-list-option .mat-list-item-content .mat-list-text,.mat-list-base .mat-list-option.mat-list-item-with-avatar .mat-list-item-content .mat-list-text,.mat-list-base .mat-list-option.mat-list-option .mat-list-item-content .mat-list-text{padding-right:0;padding-left:16px}[dir=rtl] .mat-list-base .mat-list-item.mat-list-item-with-avatar .mat-list-item-content .mat-list-text,[dir=rtl] .mat-list-base .mat-list-item.mat-list-option .mat-list-item-content .mat-list-text,[dir=rtl] .mat-list-base .mat-list-option.mat-list-item-with-avatar .mat-list-item-content .mat-list-text,[dir=rtl] .mat-list-base .mat-list-option.mat-list-option .mat-list-item-content .mat-list-text{padding-right:16px;padding-left:0}.mat-list-base .mat-list-item.mat-list-item-with-avatar .mat-list-item-content-reverse .mat-list-text,.mat-list-base .mat-list-item.mat-list-option .mat-list-item-content-reverse .mat-list-text,.mat-list-base .mat-list-option.mat-list-item-with-avatar .mat-list-item-content-reverse .mat-list-text,.mat-list-base .mat-list-option.mat-list-option .mat-list-item-content-reverse .mat-list-text{padding-left:0;padding-right:16px}[dir=rtl] .mat-list-base .mat-list-item.mat-list-item-with-avatar .mat-list-item-content-reverse .mat-list-text,[dir=rtl] .mat-list-base .mat-list-item.mat-list-option .mat-list-item-content-reverse .mat-list-text,[dir=rtl] .mat-list-base .mat-list-option.mat-list-item-with-avatar .mat-list-item-content-reverse .mat-list-text,[dir=rtl] .mat-list-base .mat-list-option.mat-list-option .mat-list-item-content-reverse .mat-list-text{padding-right:0;padding-left:16px}.mat-list-base .mat-list-item.mat-list-item-with-avatar.mat-list-option .mat-list-item-content-reverse .mat-list-text,.mat-list-base .mat-list-item.mat-list-item-with-avatar.mat-list-option .mat-list-item-content .mat-list-text,.mat-list-base .mat-list-option.mat-list-item-with-avatar.mat-list-option .mat-list-item-content-reverse .mat-list-text,.mat-list-base .mat-list-option.mat-list-item-with-avatar.mat-list-option .mat-list-item-content .mat-list-text{padding-right:16px;padding-left:16px}.mat-list-base .mat-list-item .mat-list-avatar,.mat-list-base .mat-list-option .mat-list-avatar{flex-shrink:0;width:40px;height:40px;border-radius:50%;object-fit:cover}.mat-list-base .mat-list-item .mat-list-avatar~.mat-divider-inset,.mat-list-base .mat-list-option .mat-list-avatar~.mat-divider-inset{margin-left:72px;width:calc(100% - 72px)}[dir=rtl] .mat-list-base .mat-list-item .mat-list-avatar~.mat-divider-inset,[dir=rtl] .mat-list-base .mat-list-option .mat-list-avatar~.mat-divider-inset{margin-left:auto;margin-right:72px}.mat-list-base .mat-list-item .mat-list-icon,.mat-list-base .mat-list-option .mat-list-icon{flex-shrink:0;width:24px;height:24px;font-size:24px;box-sizing:content-box;border-radius:50%;padding:4px}.mat-list-base .mat-list-item .mat-list-icon~.mat-divider-inset,.mat-list-base .mat-list-option .mat-list-icon~.mat-divider-inset{margin-left:64px;width:calc(100% - 64px)}[dir=rtl] .mat-list-base .mat-list-item .mat-list-icon~.mat-divider-inset,[dir=rtl] .mat-list-base .mat-list-option .mat-list-icon~.mat-divider-inset{margin-left:auto;margin-right:64px}.mat-list-base .mat-list-item .mat-divider,.mat-list-base .mat-list-option .mat-divider{position:absolute;bottom:0;left:0;width:100%;margin:0}[dir=rtl] .mat-list-base .mat-list-item .mat-divider,[dir=rtl] .mat-list-base .mat-list-option .mat-divider{margin-left:auto;margin-right:0}.mat-list-base .mat-list-item .mat-divider.mat-divider-inset,.mat-list-base .mat-list-option .mat-divider.mat-divider-inset{position:absolute}.mat-list-base[dense]{padding-top:4px;display:block}.mat-list-base[dense] .mat-subheader{height:40px;line-height:8px}.mat-list-base[dense] .mat-subheader:first-child{margin-top:-4px}.mat-list-base[dense] .mat-list-item,.mat-list-base[dense] .mat-list-option{display:block;height:40px;-webkit-tap-highlight-color:transparent;width:100%;padding:0}.mat-list-base[dense] .mat-list-item .mat-list-item-content,.mat-list-base[dense] .mat-list-option .mat-list-item-content{display:flex;flex-direction:row;align-items:center;box-sizing:border-box;padding:0 16px;position:relative;height:inherit}.mat-list-base[dense] .mat-list-item .mat-list-item-content-reverse,.mat-list-base[dense] .mat-list-option .mat-list-item-content-reverse{display:flex;align-items:center;padding:0 16px;flex-direction:row-reverse;justify-content:space-around}.mat-list-base[dense] .mat-list-item .mat-list-item-ripple,.mat-list-base[dense] .mat-list-option .mat-list-item-ripple{top:0;left:0;right:0;bottom:0;position:absolute;pointer-events:none}.mat-list-base[dense] .mat-list-item.mat-list-item-with-avatar,.mat-list-base[dense] .mat-list-option.mat-list-item-with-avatar{height:48px}.mat-list-base[dense] .mat-list-item.mat-2-line,.mat-list-base[dense] .mat-list-option.mat-2-line{height:60px}.mat-list-base[dense] .mat-list-item.mat-3-line,.mat-list-base[dense] .mat-list-option.mat-3-line{height:76px}.mat-list-base[dense] .mat-list-item.mat-multi-line,.mat-list-base[dense] .mat-list-option.mat-multi-line{height:auto}.mat-list-base[dense] .mat-list-item.mat-multi-line .mat-list-item-content,.mat-list-base[dense] .mat-list-option.mat-multi-line .mat-list-item-content{padding-top:16px;padding-bottom:16px}.mat-list-base[dense] .mat-list-item .mat-list-text,.mat-list-base[dense] .mat-list-option .mat-list-text{display:flex;flex-direction:column;flex:auto;box-sizing:border-box;overflow:hidden;padding:0}.mat-list-base[dense] .mat-list-item .mat-list-text>*,.mat-list-base[dense] .mat-list-option .mat-list-text>*{margin:0;padding:0;font-weight:normal;font-size:inherit}.mat-list-base[dense] .mat-list-item .mat-list-text:empty,.mat-list-base[dense] .mat-list-option .mat-list-text:empty{display:none}.mat-list-base[dense] .mat-list-item.mat-list-item-with-avatar .mat-list-item-content .mat-list-text,.mat-list-base[dense] .mat-list-item.mat-list-option .mat-list-item-content .mat-list-text,.mat-list-base[dense] .mat-list-option.mat-list-item-with-avatar .mat-list-item-content .mat-list-text,.mat-list-base[dense] .mat-list-option.mat-list-option .mat-list-item-content .mat-list-text{padding-right:0;padding-left:16px}[dir=rtl] .mat-list-base[dense] .mat-list-item.mat-list-item-with-avatar .mat-list-item-content .mat-list-text,[dir=rtl] .mat-list-base[dense] .mat-list-item.mat-list-option .mat-list-item-content .mat-list-text,[dir=rtl] .mat-list-base[dense] .mat-list-option.mat-list-item-with-avatar .mat-list-item-content .mat-list-text,[dir=rtl] .mat-list-base[dense] .mat-list-option.mat-list-option .mat-list-item-content .mat-list-text{padding-right:16px;padding-left:0}.mat-list-base[dense] .mat-list-item.mat-list-item-with-avatar .mat-list-item-content-reverse .mat-list-text,.mat-list-base[dense] .mat-list-item.mat-list-option .mat-list-item-content-reverse .mat-list-text,.mat-list-base[dense] .mat-list-option.mat-list-item-with-avatar .mat-list-item-content-reverse .mat-list-text,.mat-list-base[dense] .mat-list-option.mat-list-option .mat-list-item-content-reverse .mat-list-text{padding-left:0;padding-right:16px}[dir=rtl] .mat-list-base[dense] .mat-list-item.mat-list-item-with-avatar .mat-list-item-content-reverse .mat-list-text,[dir=rtl] .mat-list-base[dense] .mat-list-item.mat-list-option .mat-list-item-content-reverse .mat-list-text,[dir=rtl] .mat-list-base[dense] .mat-list-option.mat-list-item-with-avatar .mat-list-item-content-reverse .mat-list-text,[dir=rtl] .mat-list-base[dense] .mat-list-option.mat-list-option .mat-list-item-content-reverse .mat-list-text{padding-right:0;padding-left:16px}.mat-list-base[dense] .mat-list-item.mat-list-item-with-avatar.mat-list-option .mat-list-item-content-reverse .mat-list-text,.mat-list-base[dense] .mat-list-item.mat-list-item-with-avatar.mat-list-option .mat-list-item-content .mat-list-text,.mat-list-base[dense] .mat-list-option.mat-list-item-with-avatar.mat-list-option .mat-list-item-content-reverse .mat-list-text,.mat-list-base[dense] .mat-list-option.mat-list-item-with-avatar.mat-list-option .mat-list-item-content .mat-list-text{padding-right:16px;padding-left:16px}.mat-list-base[dense] .mat-list-item .mat-list-avatar,.mat-list-base[dense] .mat-list-option .mat-list-avatar{flex-shrink:0;width:36px;height:36px;border-radius:50%;object-fit:cover}.mat-list-base[dense] .mat-list-item .mat-list-avatar~.mat-divider-inset,.mat-list-base[dense] .mat-list-option .mat-list-avatar~.mat-divider-inset{margin-left:68px;width:calc(100% - 68px)}[dir=rtl] .mat-list-base[dense] .mat-list-item .mat-list-avatar~.mat-divider-inset,[dir=rtl] .mat-list-base[dense] .mat-list-option .mat-list-avatar~.mat-divider-inset{margin-left:auto;margin-right:68px}.mat-list-base[dense] .mat-list-item .mat-list-icon,.mat-list-base[dense] .mat-list-option .mat-list-icon{flex-shrink:0;width:20px;height:20px;font-size:20px;box-sizing:content-box;border-radius:50%;padding:4px}.mat-list-base[dense] .mat-list-item .mat-list-icon~.mat-divider-inset,.mat-list-base[dense] .mat-list-option .mat-list-icon~.mat-divider-inset{margin-left:60px;width:calc(100% - 60px)}[dir=rtl] .mat-list-base[dense] .mat-list-item .mat-list-icon~.mat-divider-inset,[dir=rtl] .mat-list-base[dense] .mat-list-option .mat-list-icon~.mat-divider-inset{margin-left:auto;margin-right:60px}.mat-list-base[dense] .mat-list-item .mat-divider,.mat-list-base[dense] .mat-list-option .mat-divider{position:absolute;bottom:0;left:0;width:100%;margin:0}[dir=rtl] .mat-list-base[dense] .mat-list-item .mat-divider,[dir=rtl] .mat-list-base[dense] .mat-list-option .mat-divider{margin-left:auto;margin-right:0}.mat-list-base[dense] .mat-list-item .mat-divider.mat-divider-inset,.mat-list-base[dense] .mat-list-option .mat-divider.mat-divider-inset{position:absolute}.mat-nav-list a{text-decoration:none;color:inherit}.mat-nav-list .mat-list-item{cursor:pointer;outline:none}mat-action-list button{background:none;color:inherit;border:none;font:inherit;outline:inherit;-webkit-tap-highlight-color:transparent;text-align:left}[dir=rtl] mat-action-list button{text-align:right}mat-action-list button::-moz-focus-inner{border:0}mat-action-list .mat-list-item{cursor:pointer;outline:inherit}.mat-list-option:not(.mat-list-item-disabled){cursor:pointer;outline:none}.mat-list-item-disabled{pointer-events:none}.cdk-high-contrast-active .mat-list-item-disabled{opacity:.5}.cdk-high-contrast-active :host .mat-list-item-disabled{opacity:.5}.cdk-high-contrast-active .mat-selection-list:focus{outline-style:dotted}.cdk-high-contrast-active .mat-list-option:hover,.cdk-high-contrast-active .mat-list-option:focus,.cdk-high-contrast-active .mat-nav-list .mat-list-item:hover,.cdk-high-contrast-active .mat-nav-list .mat-list-item:focus,.cdk-high-contrast-active mat-action-list .mat-list-item:hover,.cdk-high-contrast-active mat-action-list .mat-list-item:focus{outline:dotted 1px;z-index:1}.cdk-high-contrast-active .mat-list-single-selected-option::after{content:"";position:absolute;top:50%;right:16px;transform:translateY(-50%);width:10px;height:0;border-bottom:solid 10px;border-radius:10px}.cdk-high-contrast-active [dir=rtl] .mat-list-single-selected-option::after{right:auto;left:16px}@media(hover: none){.mat-list-option:not(.mat-list-single-selected-option):not(.mat-list-item-disabled):hover,.mat-nav-list .mat-list-item:not(.mat-list-item-disabled):hover,.mat-action-list .mat-list-item:not(.mat-list-item-disabled):hover{background:none}}
</style><style ng-transition="serverApp">.mat-icon{background-repeat:no-repeat;display:inline-block;fill:currentColor;height:24px;width:24px}.mat-icon.mat-icon-inline{font-size:inherit;height:inherit;line-height:inherit;width:inherit}[dir=rtl] .mat-icon-rtl-mirror{transform:scale(-1, 1)}.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-prefix .mat-icon,.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-suffix .mat-icon{display:block}.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-prefix .mat-icon-button .mat-icon,.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-suffix .mat-icon-button .mat-icon{margin:auto}
</style><style ng-transition="serverApp">.blog-page-container[_ngcontent-sc87]{padding:16px}.go-top[_ngcontent-sc87]{position:fixed;bottom:32px;right:64px}</style><style ng-transition="serverApp">.mat-divider[_ngcontent-sc130]{margin:8px 0}.blog-post-container[_ngcontent-sc130]{display:flex;align-items:flex-start}.blog-post-container[_ngcontent-sc130]   .blog-post-overview[_ngcontent-sc130]{flex:80%}.blog-post-container[_ngcontent-sc130]   .blog-post-toc[_ngcontent-sc130]{flex:19%}.blog-post-container[_ngcontent-sc130]   .blog-post-prev-next[_ngcontent-sc130]{display:flex;align-items:flex-start}.blog-post-container[_ngcontent-sc130]   .blog-post-prev-next[_ngcontent-sc130]   a[_ngcontent-sc130]{width:100%}.blog-post-container[_ngcontent-sc130]   .blog-post-prev-next[_ngcontent-sc130]   .blog-post-prev[_ngcontent-sc130]{display:flex;flex-direction:column;flex:50%;align-items:flex-start;justify-content:flex-start;text-align:start}.blog-post-container[_ngcontent-sc130]   .blog-post-prev-next[_ngcontent-sc130]   .blog-post-next[_ngcontent-sc130]{display:flex;flex-direction:column;flex:50%;align-items:flex-start;justify-content:flex-end;text-align:end}.blog-post-container[_ngcontent-sc130]   .blog-post-prev-next[_ngcontent-sc130]   .blog-post-prev-next-notify[_ngcontent-sc130]{display:flex;align-items:center;font-size:12px;color:#9e9e9e;width:100%}.blog-post-container[_ngcontent-sc130]   .blog-post-prev-next[_ngcontent-sc130]   .blog-post-prev-next-notify.prev[_ngcontent-sc130]{justify-content:flex-start}.blog-post-container[_ngcontent-sc130]   .blog-post-prev-next[_ngcontent-sc130]   .blog-post-prev-next-notify.next[_ngcontent-sc130]{justify-content:flex-end}.go-comment[_ngcontent-sc130]{position:fixed;bottom:32px;right:128px}</style><meta name="keywords" content="RxJS,Testing,Marble Diagrams"><meta name="description" content="今天我們來聊聊如何撰寫測試程式來確保寫出來的 RxJS 如我們所想的一般運作，也就是撰寫測試程式碼！撰寫測試程式是軟體開發中非常重要的一環，雖然不是所有程式碼都一定要有對應的測試程式，但良好的測試程式卻可以幫助我們撰寫住更加穩固的程式碼。至於到底該怎麼測試 RxJS？撰寫 RxJS 測試程式時又有什麼需要注意的呢？就讓我們繼續看下去吧！"><meta property="og:type" content="article"><meta property="og:title" content="[RxJS] 如何替 RxJS 撰寫測試 - 一般測試與彈珠圖測試方法 | 全端開發人員天梯"><meta property="og:site_name" content="全端開發人員天梯"><meta property="og:description" content="今天我們來聊聊如何撰寫測試程式來確保寫出來的 RxJS 如我們所想的一般運作，也就是撰寫測試程式碼！撰寫測試程式是軟體開發中非常重要的一環，雖然不是所有程式碼都一定要有對應的測試程式，但良好的測試程式卻可以幫助我們撰寫住更加穩固的程式碼。至於到底該怎麼測試 RxJS？撰寫 RxJS 測試程式時又有什麼需要注意的呢？就讓我們繼續看下去吧！"><meta property="og:locale" content="zh-tw"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="[RxJS] 如何替 RxJS 撰寫測試 - 一般測試與彈珠圖測試方法 | 全端開發人員天梯"><meta name="twitter:description" content="今天我們來聊聊如何撰寫測試程式來確保寫出來的 RxJS 如我們所想的一般運作，也就是撰寫測試程式碼！撰寫測試程式是軟體開發中非常重要的一環，雖然不是所有程式碼都一定要有對應的測試程式，但良好的測試程式卻可以幫助我們撰寫住更加穩固的程式碼。至於到底該怎麼測試 RxJS？撰寫 RxJS 測試程式時又有什麼需要注意的呢？就讓我們繼續看下去吧！"><style ng-transition="serverApp">[_nghost-sc113]{display:flex;align-items:center}</style><style ng-transition="serverApp">.mat-chip{position:relative;box-sizing:border-box;-webkit-tap-highlight-color:transparent;transform:translateZ(0);border:none;-webkit-appearance:none;-moz-appearance:none}.mat-standard-chip{transition:box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1);display:inline-flex;padding:7px 12px;border-radius:16px;align-items:center;cursor:default;min-height:32px;height:1px}._mat-animation-noopable.mat-standard-chip{transition:none;animation:none}.mat-standard-chip .mat-chip-remove{border:none;-webkit-appearance:none;-moz-appearance:none;padding:0;background:none}.mat-standard-chip .mat-chip-remove.mat-icon,.mat-standard-chip .mat-chip-remove .mat-icon{width:18px;height:18px;font-size:18px}.mat-standard-chip::after{top:0;left:0;right:0;bottom:0;position:absolute;border-radius:inherit;opacity:0;content:"";pointer-events:none;transition:opacity 200ms cubic-bezier(0.35, 0, 0.25, 1)}.mat-standard-chip:hover::after{opacity:.12}.mat-standard-chip:focus{outline:none}.mat-standard-chip:focus::after{opacity:.16}.cdk-high-contrast-active .mat-standard-chip{outline:solid 1px}.cdk-high-contrast-active .mat-standard-chip:focus{outline:dotted 2px}.mat-standard-chip.mat-chip-disabled::after{opacity:0}.mat-standard-chip.mat-chip-disabled .mat-chip-remove,.mat-standard-chip.mat-chip-disabled .mat-chip-trailing-icon{cursor:default}.mat-standard-chip.mat-chip-with-trailing-icon.mat-chip-with-avatar,.mat-standard-chip.mat-chip-with-avatar{padding-top:0;padding-bottom:0}.mat-standard-chip.mat-chip-with-trailing-icon.mat-chip-with-avatar{padding-right:8px;padding-left:0}[dir=rtl] .mat-standard-chip.mat-chip-with-trailing-icon.mat-chip-with-avatar{padding-left:8px;padding-right:0}.mat-standard-chip.mat-chip-with-trailing-icon{padding-top:7px;padding-bottom:7px;padding-right:8px;padding-left:12px}[dir=rtl] .mat-standard-chip.mat-chip-with-trailing-icon{padding-left:8px;padding-right:12px}.mat-standard-chip.mat-chip-with-avatar{padding-left:0;padding-right:12px}[dir=rtl] .mat-standard-chip.mat-chip-with-avatar{padding-right:0;padding-left:12px}.mat-standard-chip .mat-chip-avatar{width:24px;height:24px;margin-right:8px;margin-left:4px}[dir=rtl] .mat-standard-chip .mat-chip-avatar{margin-left:8px;margin-right:4px}.mat-standard-chip .mat-chip-remove,.mat-standard-chip .mat-chip-trailing-icon{width:18px;height:18px;cursor:pointer}.mat-standard-chip .mat-chip-remove,.mat-standard-chip .mat-chip-trailing-icon{margin-left:8px;margin-right:0}[dir=rtl] .mat-standard-chip .mat-chip-remove,[dir=rtl] .mat-standard-chip .mat-chip-trailing-icon{margin-right:8px;margin-left:0}.mat-chip-ripple{top:0;left:0;right:0;bottom:0;position:absolute;pointer-events:none;border-radius:inherit;overflow:hidden}.mat-chip-list-wrapper{display:flex;flex-direction:row;flex-wrap:wrap;align-items:center;margin:-4px}.mat-chip-list-wrapper input.mat-input-element,.mat-chip-list-wrapper .mat-standard-chip{margin:4px}.mat-chip-list-stacked .mat-chip-list-wrapper{flex-direction:column;align-items:flex-start}.mat-chip-list-stacked .mat-chip-list-wrapper .mat-standard-chip{width:100%}.mat-chip-avatar{border-radius:50%;justify-content:center;align-items:center;display:flex;overflow:hidden;object-fit:cover}input.mat-chip-input{width:150px;margin:4px;flex:1 0 150px}
</style></head>
<body>
  <app-root _nghost-sc86="" ng-version="12.2.9"><mat-toolbar _ngcontent-sc86="" color="primary" xmlns="http://www.w3.org/1999/html" class="mat-toolbar toolbar mat-elevation-z6 mat-primary mat-toolbar-single-row"><button _ngcontent-sc86="" mat-icon-button="" class="mat-focus-indicator mat-icon-button mat-button-base _mat-animation-noopable"><span class="mat-button-wrapper"><mat-icon _ngcontent-sc86="" role="img" class="mat-icon notranslate material-icons mat-icon-no-color ng-star-inserted" aria-hidden="true" data-mat-icon-type="font">menu_open</mat-icon><!----><!----></span><span matripple="" class="mat-ripple mat-button-ripple mat-button-ripple-round"></span><span class="mat-button-focus-overlay"></span></button><h1 _ngcontent-sc86=""><a _ngcontent-sc86="" routerlink="/" class="header-link" href="/"><span _ngcontent-sc86="" class="header-link-1">全端開發</span><span _ngcontent-sc86="" class="header-link-2">人員天梯</span></a></h1></mat-toolbar><mat-drawer-container _ngcontent-sc86="" class="mat-drawer-container drawer-container"><div class="mat-drawer-backdrop ng-star-inserted"></div><!----><div class="cdk-visually-hidden cdk-focus-trap-anchor" aria-hidden="true"></div><mat-drawer _ngcontent-sc86="" tabindex="-1" mode="side" disableclose="" class="mat-drawer sidebar ng-tns-c74-0 ng-trigger ng-trigger-transform mat-drawer-side mat-drawer-opened ng-star-inserted" style="transform:none;visibility:visible;"><div cdkscrollable="" class="mat-drawer-inner-container ng-tns-c74-0"><div _ngcontent-sc86="" class="post-statics ng-tns-c74-0"><div _ngcontent-sc86="" class="statics-block"><a _ngcontent-sc86="" routerlink="/blog/archives" href="/blog/archives"><div _ngcontent-sc86="" class="counter">214</div><div _ngcontent-sc86="" class="description">文章</div></a></div><div _ngcontent-sc86="" class="statics-block"><a _ngcontent-sc86="" routerlink="/blog/categories" href="/blog/categories"><div _ngcontent-sc86="" class="counter">14</div><div _ngcontent-sc86="" class="description">分類</div></a></div><div _ngcontent-sc86="" class="statics-block"><a _ngcontent-sc86="" routerlink="/blog/tags" href="/blog/tags"><div _ngcontent-sc86="" class="counter">313</div><div _ngcontent-sc86="" class="description">標籤</div></a></div></div><mat-divider _ngcontent-sc86="" role="separator" class="mat-divider ng-tns-c74-0 mat-divider-horizontal" aria-orientation="horizontal"></mat-divider><div _ngcontent-sc86="" class="ng-tns-c74-0"><div _ngcontent-sc86="" class="section-title">好書推薦</div><div _ngcontent-sc86="" class="section-content"><mat-nav-list _ngcontent-sc86="" role="navigation" class="mat-nav-list mat-list-base"><a _ngcontent-sc86="" href="https://www.tenlong.com.tw/products/9789864348039" target="_blank" style="display: flex; flex-direction: column; align-items: center;"><img _ngcontent-sc86="" src="assets/promotion/rxjs.webp" width="160px" alt="打通 RxJS 任督二脈 - 好評熱售中！"><div _ngcontent-sc86="">打通 RxJS 任督二脈</div></a></mat-nav-list></div></div><mat-divider _ngcontent-sc86="" role="separator" class="mat-divider ng-tns-c74-0 mat-divider-horizontal" aria-orientation="horizontal"></mat-divider><mat-nav-list _ngcontent-sc86="" role="navigation" class="mat-nav-list mat-list-base ng-tns-c74-0"><a _ngcontent-sc86="" mat-list-item="" routerlinkactive="active" class="mat-list-item mat-focus-indicator ng-star-inserted" href="/blog" style=""><div class="mat-list-item-content"><div mat-ripple="" class="mat-ripple mat-list-item-ripple"></div><div class="mat-list-text"></div><mat-icon _ngcontent-sc86="" role="img" class="mat-icon notranslate material-icons mat-icon-no-color" aria-hidden="true" data-mat-icon-type="font">home</mat-icon><span _ngcontent-sc86="" class="link-text">首頁</span></div></a><a _ngcontent-sc86="" mat-list-item="" routerlinkactive="active" class="mat-list-item mat-focus-indicator ng-star-inserted" href="/blog/categories" style=""><div class="mat-list-item-content"><div mat-ripple="" class="mat-ripple mat-list-item-ripple"></div><div class="mat-list-text"></div><mat-icon _ngcontent-sc86="" role="img" class="mat-icon notranslate material-icons mat-icon-no-color" aria-hidden="true" data-mat-icon-type="font">apps</mat-icon><span _ngcontent-sc86="" class="link-text">分類</span></div></a><a _ngcontent-sc86="" mat-list-item="" routerlinkactive="active" class="mat-list-item mat-focus-indicator ng-star-inserted" href="/blog/tags" style=""><div class="mat-list-item-content"><div mat-ripple="" class="mat-ripple mat-list-item-ripple"></div><div class="mat-list-text"></div><mat-icon _ngcontent-sc86="" role="img" class="mat-icon notranslate material-icons mat-icon-no-color" aria-hidden="true" data-mat-icon-type="font">label</mat-icon><span _ngcontent-sc86="" class="link-text">標籤</span></div></a><a _ngcontent-sc86="" mat-list-item="" routerlinkactive="active" class="mat-list-item mat-focus-indicator ng-star-inserted" href="/blog/archives" style=""><div class="mat-list-item-content"><div mat-ripple="" class="mat-ripple mat-list-item-ripple"></div><div class="mat-list-text"></div><mat-icon _ngcontent-sc86="" role="img" class="mat-icon notranslate material-icons mat-icon-no-color" aria-hidden="true" data-mat-icon-type="font">archive</mat-icon><span _ngcontent-sc86="" class="link-text">歸檔</span></div></a><!----></mat-nav-list><mat-divider _ngcontent-sc86="" role="separator" class="mat-divider ng-tns-c74-0 mat-divider-horizontal" aria-orientation="horizontal"></mat-divider><mat-nav-list _ngcontent-sc86="" role="navigation" class="mat-nav-list mat-list-base ng-tns-c74-0"><a _ngcontent-sc86="" mat-list-item="" href="/blog/atom.xml" target="_blank" class="mat-list-item mat-focus-indicator"><div class="mat-list-item-content"><div mat-ripple="" class="mat-ripple mat-list-item-ripple"></div><div class="mat-list-text"></div><mat-icon _ngcontent-sc86="" role="img" class="mat-icon notranslate material-icons mat-icon-no-color" aria-hidden="true" data-mat-icon-type="font">rss_feed</mat-icon><span _ngcontent-sc86="" class="link-text">RSS</span></div></a><a _ngcontent-sc86="" mat-list-item="" href="https://github.com/wellwind/" target="_blank" class="mat-list-item mat-focus-indicator"><div class="mat-list-item-content"><div mat-ripple="" class="mat-ripple mat-list-item-ripple"></div><div class="mat-list-text"></div><mat-icon _ngcontent-sc86="" role="img" fontset="fontawesome" fonticon="fa-github" class="mat-icon notranslate fa-github fab mat-icon-no-color" aria-hidden="true" data-mat-icon-type="font" data-mat-icon-name="fa-github" data-mat-icon-namespace="fontawesome"></mat-icon><span _ngcontent-sc86="" class="link-text">GitHub</span></div></a><a _ngcontent-sc86="" mat-list-item="" href="https://www.facebook.com/fullstackledder" target="_blank" class="mat-list-item mat-focus-indicator"><div class="mat-list-item-content"><div mat-ripple="" class="mat-ripple mat-list-item-ripple"></div><div class="mat-list-text"></div><mat-icon _ngcontent-sc86="" role="img" fontset="fontawesome" fonticon="fa-facebook" class="mat-icon notranslate fa-facebook fab mat-icon-no-color" aria-hidden="true" data-mat-icon-type="font" data-mat-icon-name="fa-facebook" data-mat-icon-namespace="fontawesome"></mat-icon><span _ngcontent-sc86="" class="link-text">Facebook</span></div></a></mat-nav-list><div _ngcontent-sc86="" data-href="https://www.facebook.com/fullstackledder" data-tabs="timeline" data-width="235" data-height="450" data-small-header="true" data-adapt-container-width="true" data-hide-cover="true" data-show-facepile="true" class="fb-page ng-tns-c74-0"><blockquote _ngcontent-sc86="" cite="https://www.facebook.com/fullstackledder" class="fb-xfbml-parse-ignore"><a _ngcontent-sc86="" href="https://www.facebook.com/fullstackledder">全端開發人員天梯</a></blockquote></div></div></mat-drawer><div class="cdk-visually-hidden cdk-focus-trap-anchor" aria-hidden="true"></div><mat-drawer-content _ngcontent-sc86="" class="mat-drawer-content main-content server" style="margin-left:;margin-right:;"><router-outlet _ngcontent-sc86=""></router-outlet><app-blog-layout _nghost-sc87="" class="ng-star-inserted"><div _ngcontent-sc87="" class="blog-page-container"><router-outlet _ngcontent-sc87=""></router-outlet><app-blog-post _nghost-sc130="" class="ng-star-inserted"><div _ngcontent-sc130="" class="blog-post-container ng-star-inserted"><div _ngcontent-sc130="" class="blog-post"><div _ngcontent-sc130="" class="blog-post-title"><h1 _ngcontent-sc130="">[RxJS] 如何替 RxJS 撰寫測試 - 一般測試與彈珠圖測試方法</h1></div><div _ngcontent-sc130="" class="blog-post-subtitle"><app-blog-post-subtitle _ngcontent-sc130="" _nghost-sc113=""><span _ngcontent-sc113="" class="blog-post-published ng-star-inserted"><mat-icon _ngcontent-sc113="" role="img" class="mat-icon notranslate material-icons mat-icon-no-color" aria-hidden="true" data-mat-icon-type="font">date_range</mat-icon><span _ngcontent-sc113="">2020-10-21</span></span><span _ngcontent-sc113="" class="blog-post-categories ng-star-inserted"><mat-icon _ngcontent-sc113="" role="img" class="mat-icon notranslate material-icons mat-icon-no-color" aria-hidden="true" data-mat-icon-type="font">folder_open</mat-icon><a _ngcontent-sc113="" class="blog-post-category-link ng-star-inserted" href="/blog/categories/%E6%89%93%E9%80%9A-RxJS-%E4%BB%BB%E7%9D%A3%E4%BA%8C%E8%84%88">打通 RxJS 任督二脈</a><span _ngcontent-sc113="" class="sub-divider ng-star-inserted">|</span><!----><!----><a _ngcontent-sc113="" class="blog-post-category-link ng-star-inserted" href="/blog/categories/%E7%AC%AC-12-%E5%B1%86%E9%90%B5%E4%BA%BA%E8%B3%BD">第 12 屆鐵人賽</a><!----><!----><!----></span><!----><!----><!----><!----></app-blog-post-subtitle></div><mat-divider _ngcontent-sc130="" role="separator" class="mat-divider mat-divider-horizontal" aria-orientation="horizontal"></mat-divider><div _ngcontent-sc130="" class="blog-post"><p>今天我們來聊聊如何撰寫測試程式來確保寫出來的 RxJS 如我們所想的一般運作，也就是撰寫測試程式碼！撰寫測試程式是軟體開發中非常重要的一環，雖然不是所有程式碼都一定要有對應的測試程式，但良好的測試程式卻可以幫助我們撰寫住更加穩固的程式碼。</p>
<p>至於到底該怎麼測試 RxJS？撰寫 RxJS 測試程式時又有什麼需要注意的呢？就讓我們繼續看下去吧！</p>
<h1 id="範例專案說明">範例專案說明</h1>
<p>這邊假設大家對於撰寫前端測程式已經有一定理解和經驗了，就不多說明基本的撰寫測試方法了；接下來我們撰寫的測試程式都是運行在 <a href="https://karma-runner.github.io/latest/index.html">Karma</a> + <a href="https://jasmine.github.io/">Jasmine</a> 上，原始檔如下：</p>
<p><a href="https://github.com/wellwind/rxjs-marble-testing-demo">https://github.com/wellwind/rxjs-marble-testing-demo</a></p>
<p>當然，想要用其他測試框架也是完全 ok 的喔！</p>
<p>只要專案下載下來後執行 <code>npm install</code> 安裝相關套件，接著執行 <code>npm run test</code> 即可看到所有測試程式執行的結果。</p>
<h2 id="專案結構">專案結構</h2>
<p>範例專案內多數都是些基本的設定如使用套件、TypeScript 設定等等，另外有兩個重要的目錄：</p>
<ul>
<li><code>src</code>：所有要測試的目標程式碼所在的位置</li>
<li><code>test</code>：所有針對測試目標所撰寫的測試程式碼</li>
</ul>
<h2 id="測試目標">測試目標</h2>
<p>在 RxJS 中，基本上有兩件事情要測試，分別是</p>
<ul>
<li>Observable 訂閱得到的結果是否正確</li>
<li>Observable 資料流動的過程是否正確</li>
</ul>
<p>在範例專案中，我們設計了幾種 Observable，有些很好測試，有些則相對沒那麼簡單：</p>
<pre><code class="language-typescript">export const emitOne$ = of(1);
export const emitOneToFour$ = of(1, 2, 3, 4);
export const emitOntToFourPerSecond$ = timer(0, 1000).pipe(
  take(4)
);
</code></pre>
<p>另外我們也設計了一個 operator：</p>
<pre><code class="language-typescript">export const plusOne = () 
  =&gt; (source$: Observable&lt;number&gt;) 
	=&gt; source$.pipe(map(value =&gt; value + 1));
</code></pre>
<p>這個 operator 內容很簡單，將輸入的資料加一而已，主要是拿來測試整個資料流是否能依照我們設計的 operator 流動。</p>
<p>另外，我們在前幾天<a href="https://wellwind.idv.tw/blog/2020/10/16/mastering-rxjs-31-practicing-autocomplete-search-sort-pagination/">實戰介紹「自動完成」功能</a>時，有透過組合好幾個 operators 來讓資料查詢不要那麼頻繁，我們也將它抽成一個比較複雜一點的 operator 來測試看看：</p>
<pre><code class="language-typescript">export const debounceInput = () 
  =&gt; (source$: Observable&lt;string&gt;) 
    =&gt; source$.pipe(
      debounceTime(300),
      distinctUntilChanged(),
      filter(data =&gt; data.length &gt;= 3)
    );
</code></pre>
<p>接著就讓我們來看看兩種不同的測試手法，一種很簡單，但比較難測試各種情境；另外一種比較複雜，但可以應付幾乎所有情境的測試。</p>
<h1 id="在-subscribe-callback-內進行測試">在 subscribe callback 內進行測試</h1>
<p>第一種方法很簡單，這種手法在「同步 Observable」或是「非同步 Observable 但有明確結束時機點」兩種狀況時適合使用，也不用想太多，直接在 <code>subscribe</code> 的 callback 方法內測試結果即可。</p>
<p>測試程式碼請參考範例專案內的 <code>test/subscribe-test.spec.ts</code>。</p>
<h2 id="單一事件值的-observable-測試">單一事件值的 Observable 測試</h2>
<p>針對 <code>of(1)</code> 這種只有一個事件值的測試程式可以很容易的直接在 <code>subscribe</code> 內進行驗證：</p>
<pre><code class="language-typescript">// const emitOne$ = of(1);
it('測試單一個事件的 Observable', () =&gt; {
  emitOne$.subscribe(data =&gt; {
    expect(data).toEqual(1);
  });
});
</code></pre>
<p>非常簡單吧！</p>
<h2 id="多個事件值的-observable-測試">多個事件值的 Observable 測試</h2>
<p>那麼如果來源 Observable 有多個事件值呢？<code>expect(data)</code> 後面該怎麼寫？這時我們可以在 <code>subscribe</code> 時將訂閱值存起來，再測試結果：</p>
<pre><code class="language-typescript">// const emitOneToFour$ = of(1, 2, 3, 4);
it('測試多個事件的 Observable', () =&gt; {
  const actual: number[] = [];
  emitOneToFour$.subscribe(data =&gt; {
    actual.push(data);
  });
  expect(actual).toEqual([1, 2, 3, 4]);
});
</code></pre>
<p>上述程式第 4 行將每次事件資料存到 <code>actual</code> 陣列中，接著在第 7 行比較結果。由於整個 Observable 是「同步執行」的，因此可以確定所有事件都發送完畢，直到 Observable 結束後才進行比較。</p>
<h2 id="非同步-observable-測試">非同步 Observable 測試</h2>
<p>如果是「非同步執行」的 Observable 如 <code>timer</code> 處理呢？那就先要看測試框架是否支援非同步處理了，以 Jasmine 來說可以在測試 function 內傳入一個 <code>done</code> 的 function，並在非同步程式中測試完畢後呼叫它代表非同步程式結束：</p>
<pre><code class="language-typescript">// const emitOntToFourPerSecond$ = timer(0, 1000).pipe(
//   take(4)
// );
it('測試非同步處理的 Observable', (done) =&gt; {
  const actual: number[] = [];
  emitOntToFourPerSecond$.subscribe({
    next: data =&gt; {
      actual.push(data);
    },
    complete: () =&gt; {
      expect(actual).toEqual([0, 1, 2, 3]);
      done();
    }
  });
});
</code></pre>
<p>上述程式第 8 行在 <code>subscribe</code> 中的 <code>next()</code> 將來源資料存入陣列，直到 Observable 結束後，在 <code>complete()</code> 內驗證測試結果，並呼叫 <code>done()</code> 告知測試框架「非同步處理的程式碼測試完畢」。</p>
<p>這種方式看起來合理，但上面程式碼實際上有一些缺點</p>
<ul>
<li>來源 Observable 到結束會等待 3 秒鐘，如果程式內有許多類似的 Observable 要測試，就會讓整體測試時間拉長</li>
<li>大部分測試框架在處理非同步時，都會給一個等待時間，逾時就會自動失敗，以 Jasmine 來說預設是 5 秒鐘，也就是 Observable 會需要超過 5 秒鐘的話，必須另外設定拉長等待時間</li>
<li>如果是一個不會結束的 Observable 呢？雖然我們也可以在程式中主動加上 <code>take()</code> operator 或想辦法加上其他條件讓它結束，但那就變成在寫程式而不是寫測試了，因此不是個推薦的解法</li>
</ul>
<p>這些問題，在之後介紹「彈珠圖測試」時會解決。</p>
<h2 id="operator-測試">Operator 測試</h2>
<p>如果要測試某個自訂的 operator 是否如我們預期處理資料流，只需要準備一個來源 Observable 並搭配 <code>pipe</code> 將資料傳入我們自訂的 operator 即可：</p>
<pre><code class="language-typescript">// const plusOne = () 
//   =&gt; (source$: Observable&lt;number&gt;) 
//     =&gt; source$.pipe(map(value =&gt; value + 1));
it('使用 pipe 測試 operator', () =&gt; {
  of(1).pipe(
    plusOne()
  ).subscribe(data =&gt; {
    expect(data).toEqual(2);
  });
});

it('單獨測試一個 operator', () =&gt; {
  const source$ = of(1);
  plusOne()(source$).subscribe(data =&gt; {
    expect(data).toEqual(2);
  });
});
</code></pre>
<p>有兩種測試方式，其實是一樣的概念，第一種是把它真的當作 operator，以操作 operator 的方式處理，因此第 5 行使用 <code>of(1).pipe(...)</code> 的方式，來確認資料流向及處理。</p>
<p>而第二種測試是把它當作一個 function，因為 operator 其實就是一個 function 而已，所以第 14 行我們呼叫這個 <code>plusOne</code> function 後，會得到一個參數和回傳值都是 Observable 的 function，再把我們的來源 Observable 當參數傳入，然後訂閱測試結果。</p>
<h1 id="marble-testing-彈珠圖測試">Marble Testing 彈珠圖測試</h1>
<p>上一段落我們單純的使用測試框架提供的功能來進行測試，已經足以應付不少情境了，但還是有些情境不是那麼適合，因此 RxJS 提供了一個 <strong>TestScheduler</strong> 測試工具，來協助我們以更直覺、圖像的方式處理各種同步、非同步的 RxJS 程式碼！</p>
<p></p><div class="note info"><p>Scheduler 是用來「安排」事件發生時機點的工具，而 TestScheduler 就是其中一種，這種 Scheduler 可以幫助我們處理測試中遇到的各種問題。</p>
<p>關於 Scheduler，可以參考之前的文章「<a href="https://wellwind.idv.tw/blog/2020/10/19/mastering-rxjs-34-introduce-scheduler-of-rxjs/">[RxJS] 認識 Scheduler</a>」</p></div><p>
</p><h2 id="認識-testscheduler">認識 TestScheduler</h2>
<p>TestScheduler 是 RxJS 開發出來協助我們撰寫測試程式的工具，它可以幫助我們：</p>
<ul>
<li>將所有「非同步執行」的 RxJS 程式碼轉換成「同步執行」</li>
<li>建立假的 Observable，Hot 或 Cold Observable 都可以</li>
<li>讓我們使用彈珠圖的視覺方式確認程式碼運作結果</li>
</ul>
<p>不過 TestScheduler 使用上也有些條件：「必須使用跟 timer 相關的 Observable 當作測試來源，如 <code>timer</code>、<code>interval</code>、<code>delay</code> 等等」，這類型的測試來源都是使用 <code>asyncScheduler</code>；而使用 Promise 或是其他非同步的 Scheduler 如 <code>asapScheduler</code> 和 <code>animationFrameScheduler</code> 則會變得比較不可靠，這是需要注意的一點。</p>
<p></p><div class="note info"><p>當然，遇到這種狀況時，還是可以走回原來 <code>subsctibe</code> callback 的測試方式</p></div><p>
</p><h2 id="使用-testscheduler-的基本流程">使用 TestScheduler 的基本流程</h2>
<h3 id="起手式：建立-testscheduler">起手式：建立 TestScheduler</h3>
<p>要建立 TestScheduler 很簡單，因為它只是個類別，直接 new 它就好，而在建立時需要傳入一個 callback function 用來決定如何比較兩個物件是否相同。</p>
<pre><code class="language-typescript">const testScheduler = new TestScheduler((actual, expected) =&gt; {
  expect(actual).toEqual(expected);
});
</code></pre>
<p>上述程式我們產生了一個新的 TestScheduler，並在建立時指定比較兩個物件的方法，以 Jasmine 的例子來說，我們使用 <code>toEqual</code> 來進行深層比較 (deep equality comparison)，以確保物件內所有屬性都完全相等。如果使用其他測試框架，則須要看該測試框架使用那種方式比較兩個物件。</p>
<h3 id="呼叫-run()-取得測試用的-helper">呼叫 run() 取得測試用的 helper</h3>
<p>建立好 TestScheduler 後，我們需要呼叫該物件的 <code>run()</code> 方法，<code>run()</code> 方法內也是一個 callback function，在此 function 內會得到一個 <code>helper</code> 物件，這個物件可以幫助我們「以同步的方式測試非同步 Observable」，這個 helper 包含幾個方法：</p>
<ul>
<li><code>hot</code>：依照指定的彈珠圖建立一個 Hot Observable</li>
<li><code>cold</code>：依照指定的蛋ˋ豬屠建立一個 Cold Observable</li>
<li><code>expectObservable(...).toBe(...)</code>：用來判斷兩條 Observable 是否結果相同</li>
<li><code>expectSubscription(...).toBe(...)</code>：用來判斷「訂閱」和「結束訂閱」的結果是否符合預期</li>
<li><code>flush</code>：用來立即完成一個 Observable，通常用不到，只要在很細的控制測試需要</li>
</ul>
<h2 id="認識測試用彈珠圖">認識測試用彈珠圖</h2>
<p>我們之前已經介紹過了「文字版彈珠圖」，裡面的符號在一般溝通時已經足夠使用，但在測試時，需要更精準的知道事件發生的時間，因此讓我們回顧一下基本的符號、在測試時的意義，以及之前沒有用到的符號。</p>
<ul>
<li><code>-</code>：如同之前所介紹，它是一個時間的最小單位，在測試中我們稱為一個 <code>frame</code>，通時它也虛擬地代表了 1 毫秒。</li>
<li><code>  </code>：空白符號，一樣只是用來對齊使用，不會發生任何事情，也不代表時間</li>
<li><code>[0-9]+[ms|s|m]</code>：代表經過了多少時間，畢竟一個 <code>-</code> 代表 1 毫秒，那一秒鐘要畫 1000 個 <code>-</code>，太辛苦了</li>
<li><code>[a-z0-9]</code>：代表事件發生了，一個符號代表一個事件值發生了，也就是 <code>next()</code> 被呼叫了</li>
<li><code>( )</code>：用來群組同時間發生的資料，例如 <code>(12)</code> 並不是事件「十二」發生，而是同一個時間點 (frame) 發生了 <code>1</code> 和 <code>2</code> 兩個事件</li>
<li><code>|</code>：Observable 完成</li>
<li><code>#</code>：Observable 發生錯誤</li>
<li><code>^</code>：代表訂閱開始的時間點，專門用來測試訂閱何時開始的</li>
<li><code>!</code>：代表訂閱結束的時間點，專門用來測試訂閱何時結束的</li>
</ul>
<p>上述符號在測試時，<code>^</code> 和 <code>!</code> 在測試 Observable 資料流程時不可使用；而在測試訂閱時機時，則可以使用 <code>^</code>、<code>!</code>、和時間相關的符號 <code>1</code> 和 <code>[0-9]+[ms|s|m]</code>，稍後看到實際程式會更加清楚。</p>
<p>實際畫幾個圖來說明一下：</p>
<ul>
<li>使用時間符號取代 frame (<code>-</code>)</li>
</ul>
<pre><code>----------
(10ms)
// 上下兩組發生時間一樣長
</code></pre>
<ul>
<li>對齊加上時間符號</li>
</ul>
<pre><code>--- 1s ---
// 實際上用掉了 1006 個 frames
---    ---
// 實際只用掉了 6 個 frames
</code></pre>
<ul>
<li>事件發生加上時間符號</li>
</ul>
<pre><code>a 1s b
=&gt; a 事件發生後，再等待 1000 個 frames 後發生 b 事件
</code></pre>
<ul>
<li>事件發生在同一個 frame</li>
</ul>
<pre><code>---  1   ---
---(abc)---
=&gt; 用掉了 7 個 frame，事件 abc 都在同一個 frame 發生
</code></pre>
<ul>
<li>訂閱發生時間</li>
</ul>
<pre><code>---1---2---3---4---5|
     ^-----------|
     =&gt; 實際上訂閱的時間點
</code></pre>
<h2 id="彈珠圖測試範例">彈珠圖測試範例</h2>
<p>接著就讓我們直接舉例，用彈珠圖來進行測試看看吧！我們先把 Observable 都寫在測試程式裡面，以便理解各種彈珠圖測試方式。</p>
<p>測試程式碼請參考範例專案內的 <code>test/marble-test-basic.spec.ts</code>。</p>
<h3 id="基本彈珠圖測試">基本彈珠圖測試</h3>
<p>首先第一步，在每個要使用 TestScheduler 的測試之前，都需要建立一次 TestScheduler，因此我們用 <code>beforeEach</code> 來處理：</p>
<pre><code class="language-typescript">describe('使用 TestScheduler 測試', () =&gt; {
  let testScheduler: TestScheduler;

  beforeEach(() =&gt; {
    testScheduler = new TestScheduler((actual, expected) =&gt; {
      expect(actual).toEqual(expected);
    });
  });    
});
</code></pre>
<p>接著只要在測試案例的 <code>it</code> 內，呼叫 <code>testScheduler.run()</code> 並執行測試即可，以下以 <code>take</code> operator 進行示範：</p>
<pre><code class="language-typescript">it('測試 take operator', () =&gt; {
  testScheduler.run(helpers =&gt; {
    const { cold, expectObservable, expectSubscriptions } = helpers;

    const sourceMarbleDiagram =  '---a---b---c---d---e---|';
    const expectedSubscription = '^----------!';
    const expectedResult =       '---a---b---(c|)';

    const sourceObservable = cold(sourceMarbleDiagram);
    const source$ = sourceObservable.pipe(take(3));

    expectObservable(source$)
      .toBe(expectedResult);
    expectSubscriptions(sourceObservable.subscriptions)
      .toBe(expectedSubscription);
  });
});
</code></pre>
<ul>
<li>第 2 行：呼叫 <code>testScheduler.run</code> 開始進行彈珠圖測試</li>
<li>第 3 行：將需要的程式從 <code>helpers</code> 中取出</li>
<li>第 5 行：來源 Observable 的彈珠圖</li>
<li>第 6 行：實際測試的 Observable 訂閱後預期的訂閱時機點</li>
<li>第 7 行：實際測試的 Observable 預期產出的彈珠圖</li>
<li>第 9 行：依照第 5 行的彈珠圖，建立一個 Cold Observable</li>
<li>第 10 行：建立實際要測試的 Observable，一般來說就是來源 Observable (第 9 行建立) 加上要測試的 operators (以這邊的例子是 <code>take(3)</code>)</li>
<li>第 12 行，使用 <code>expectObservable</code> 測試 <code>source$</code> 訂閱後產生的資料流彈珠圖是否符合預期</li>
<li>第 14 行，使用 <code>expectSubscriptions</code> 測試 <code>source$</code> 的訂閱時機點 (<code>sourceObservable.subscription</code>)是否符合預期</li>
</ul>
<p>這樣就完成第一個彈珠圖測試啦！之後要進行彈珠圖測試時，可以用同樣的模式，把要被測試的目標換掉 (以這邊的例子是 <code>source$</code>)，以及設定正確的彈珠圖，就可以看到結果囉！</p>
<h3 id="帶入指定物件到彈珠圖內">帶入指定物件到彈珠圖內</h3>
<p>上述例子我們用 <code>a</code>、<code>b</code> 和 <code>c</code> 當作事件值，但實際上我們的來源 Observable 不會只有這麼單純的文字資料而已，很多時候都是物件的處理，這時候我們可以在使用 <code>cold</code> 和 <code>hot</code> 建立 Observable 時給予一個對應事件名稱當作屬性的物件，當作來源資料；同時在 <code>expectObservable</code> 時用一樣的方式給予物件，當作結果資料。先看個簡單的例子：</p>
<pre><code class="language-typescript">it('測試 map operator (帶入 value)', () =&gt; {
  testScheduler.run(helpers =&gt; {
    const { cold, expectObservable } = helpers;
    const sourceMarbleDiagram = '--a--b--c--d--|';
    const expectedResult =      '--w--x--y--z--|';

    const sourceObservable = cold(sourceMarbleDiagram, { a: 1, b: 2, c: 3, d: 4 });
    const source$ = sourceObservable.pipe(map(value =&gt; value + 1));
    expectObservable(source$).toBe(expectedResult, { w: 2, x: 3, y: 4, z: 5 });
  });
});
</code></pre>
<ul>
<li>第 4 行和第 5 行建立彈珠圖，包含來源 Observable 和預期轉換成新的 Observable 的彈珠圖</li>
<li>第 7 行使用 <code>cold</code> 建立 Cold Observable 時，除了給予彈珠圖文字外，也傳入一個物件，因此彈珠圖上的事件 <code>a</code> 實際上發出的事件值會是物件內的數字 <code>1</code>，以此類推</li>
<li>第 9 行在比較彈珠圖結果時，<code>toBe</code> 傳入預期的結果物件，因此彈珠圖上的事件 <code>w</code> 實際上會發出的事件值會是物件內的數字 <code>2</code>，以此類推</li>
</ul>
<p>看完簡單的例子後，改成帶入更複雜的物件看看，原理一樣，就不多說明囉：</p>
<pre><code class="language-typescript">it('測試 map operator (帶入更複雜的 value)', () =&gt; {
  testScheduler.run(helpers =&gt; {
    const { cold, expectObservable } = helpers;

    const input = {
      a: { name: 'Student A', score: 25 },
      b: { name: 'Student B', score: 49 },
      c: { name: 'Student C', score: 100 },
      d: { name: 'Student D', score: 0 }
    };
    const expected = {
      w: { name: 'Student A', score: 50 },
      x: { name: 'Student B', score: 70 },
      y: { name: 'Student C', score: 100 },
      z: { name: 'Student D', score: 0 }
    };

    const sourceMarbleDiagram = '--a--b--c--d--|';
    const expectedResult =      '--w--x--y--z--|';

    const sourceObservable = cold(sourceMarbleDiagram, input);

    const source$ = sourceObservable.pipe(
      map(student =&gt; ({ ...student, score: Math.sqrt(student.score) * 10 }))
    );
    expectObservable(source$).toBe(expectedResult, expected);
  });
});
</code></pre>
<h3 id="測試長時間的-observable">測試長時間的 Observable</h3>
<p>使用 <code>testScheuler</code> 除了可以畫圖用視覺畫理解測試外，另一個最大的方便就是一切都變成同步執行的，儘管 Observable 是每秒發生一次，在 <code>testScheduler</code> 內也只是虛擬時間，不會等待那麼長的時間，而彈珠圖中也可以直接用時間單位表達發生多久，如下：</p>
<pre><code class="language-typescript">it('測試時間 time frame', () =&gt; {
  testScheduler.run(helpers =&gt; {
    const { cold, expectObservable } = helpers;

    const sourceMarbleDiagram = '(123|)';
    const expectedResult =      '--- 7ms 1 9ms 2 9ms (3|)';

    const sourceObservable = cold(sourceMarbleDiagram);
    const source$ = sourceObservable.pipe(
      concatMap(value =&gt; of(value).pipe(delay(10)))
    );

    expectObservable(source$).toBe(expectedResult);
  });
});
</code></pre>
<p>這裡重點測試是 <code>source$</code> 內的 <code>delay(10)</code>，透過 <code>concatMap</code> 讓原始 Observable 的每個值都延遲 10ms 發生，然後串在一起。</p>
<p>在 <code>expectedResult</code> 裡面 <code>--- 7ms</code> 實際上就是 10 毫秒，直接寫成 <code>10 ms</code> 也可以，意義完全一樣；；而整體 Observable 彈珠圖則是 <code>1 9ms 2 9ms (3|)</code>，值得注意的是每次事件發生的那個當下也代表了一個 <code>frame</code>，因此是 <code>1 9ms</code> 而不是 <code>1 10ms</code>，而最後事件值 <code>3</code> 發生後會直接結束，因此使用 <code>( )</code> 包起來， <code>(3|)</code> 代表兩個事件 (<code>3</code> 和 <code>|</code> 結束) 是在同一個 frame 發生的。</p>
<p>就算是一個不會結束的 Observable，彈珠圖畫出來也只是沒有 <code>|</code> 符號而已囉。</p>
<h3 id="測試-hot-observable">測試 Hot Observable</h3>
<p>Cold Observable 在每次訂閱時會重新跑完整個資料流，而 Hot Observable 則是一個資料流，在不同時間點訂閱可能會得到不同的結果，因此 Hot Observable 測試時還有一個重點，就是不同時間訂閱的結果，聽起來很麻煩，但一畫成彈珠圖就簡單多了！</p>
<pre><code class="language-typescript">it('測試 Hot Observable', () =&gt; {
  testScheduler.run((helpers) =&gt; {
    const { hot, expectObservable } = helpers;

    const sourceMarbleDiagram = '--1--2--3--4--5--6--7--8';
    const subscription1 =       '-------^-------!';
    const subscription2 =       '-----------^-----!';
    const expectedResult1 =     '--------3--4--5-';
    const expectedResult2 =     '-----------4--5---';

    const sourceObservable = hot(sourceMarbleDiagram);

    expectObservable(sourceObservable, subscription1).toBe(expectedResult1);
    expectObservable(sourceObservable, subscription2).toBe(expectedResult2);
  });
});
</code></pre>
<p>上面程式我們只訂了兩個訂閱時機 (<code>subscription1</code> 和 <code>subscription2</code>)，從彈珠圖就可以看到時機點的不同，以及畫出兩種預期得到資料的結果，在處理 Hot Observable 時，可以在 <code>expectObservable</code> 中給予訂閱的時機，藉此來比較該訂閱時機點下，得到的彈珠圖是否與預期相同。</p>
<h2 id="使用彈珠圖測試實際的-observables-與-operators">使用彈珠圖測試實際的 Observables 與 Operators</h2>
<p>有了這些觀念後，就讓我們實際測試看看一開始寫的那些程式吧！</p>
<p>測試程式碼可以參考範例專案內的 <code>src/marble-test-for-observables.spec.ts</code> 以及 <code>src/marble-test-debounce-input.spec.ts</code> 兩個檔案，裡面有各種寫法，有了前面的觀念後要寫出類似的測試程式應該不困難，這裡只挑出一些重點。</p>
<h3 id="基本彈珠圖測試">基本彈珠圖測試</h3>
<p>與之前一樣，只是來源 Observable 是我們真正寫好的程式碼：</p>
<pre><code class="language-typescript">it('使用彈珠圖測試單一個事件的 Observable', () =&gt; {
  testScheduler.run((helpers) =&gt; {
    const { expectObservable } = helpers;

    // 1 會被當事件字串，因此不能這樣寫
    // const expectedResult = (1|);
    const expected = '(a|)';
    expectObservable(emitOne$).toBe(expected, { a: 1 });
  });
});
</code></pre>
<p>這裡有一個值得注意的小地方，由於彈珠圖內的事件預設都是字串，因此 <code>of(1)</code> 雖然一般可以想成彈珠圖 <code>(1|)</code>，但在測試時 <code>1</code> 會被當作字串，而跟結果比較不符合，所以正確的寫法是給一個字母如 <code>a</code> 當作事件點，然後把物件傳入來指定該是件時間點的事件值。</p>
<h3 id="測試多個事件的-observable">測試多個事件的 Observable</h3>
<p>可以畫彈珠圖之後，一切就變得簡單啦！</p>
<pre><code class="language-typescript">it('使用彈珠圖測試多個事件的 Observable', () =&gt; {
  testScheduler.run(helpers =&gt; {
    const { expectObservable } = helpers;

    const expected = '(abcd|)';
    expectObservable(emitOneToFour$).toBe(expected, { a: 1, b: 2, c: 3, d: 4 });
  });
});
</code></pre>
<p>一樣要注意的是資料型態問題。</p>
<h3 id="測試非同步的-observable">測試非同步的 Observable</h3>
<p>要測試非同步 Observable 也不困難，在彈珠圖上標記經過時間即可：</p>
<pre><code class="language-typescript">it('使用彈珠圖測試非同步處理的 Observable', () =&gt; {
  testScheduler.run((helpers) =&gt; {
    const { expectObservable } = helpers;

    // 因為事件本身佔一個 frame，所以用 999ms
    const expected = 'a 999ms b 999ms c 999ms (d|)';
    expectObservable(emitOntToFourPerSecond$).toBe(expected, { a: 0, b: 1, c: 2, d: 3 });
  });
});
</code></pre>
<p>跟之前提過的一樣，事件發生點本身就佔一個 frame，這是需要多注意的地方。</p>
<h3 id="測試複雜的-observable">測試複雜的 Observable</h3>
<p>最後要來測試前面提到旦沒測試過的 <code>debounceInput()</code> 啦！這個 <code>debounceInput()</code> 是三個 operators 組合起來的，所以至少根據每個 operator 特性會撰寫一組測試案例才對，同時這些測試案例的結果也必須符合組合起來的結果。</p>
<p>首先是最簡單的「文字長度大於等於 3」也就是 <code>filter(data =&gt; data.length &gt;= 3)</code> 的條件：</p>
<pre><code class="language-typescript">it('文字長度大於等於 3 才允許事件發生', () =&gt; {
  testScheduler.run((helpers) =&gt; {
    const { cold, expectObservable } = helpers;
    const input = {
      a: 'rxjs',
      b: 'rx',
    };
    const expectedOutput = {
      x: 'rxjs',
    };

    // b 事件的內容不到 3 個字，因此沒有事件發生
    const sourceMarbleDiagram = 'a 300ms   100ms b';
    const expectedResult =      '  300ms x 100ms  ';

    const sourceObservable = cold(sourceMarbleDiagram, input);
    const source$ = sourceObservable.pipe(debounceInput());
    expectObservable(source$).toBe(expectedResult, expectedOutput);
  });
});
</code></pre>
<p><code>input</code> 代表每次事件發生時輸入的內容，可以搭配 <code>sourceMarbleDiagram</code> 彈珠圖一起看，而 <code>expectedOutput</code> 則搭配 <code>expectedResult</code> 彈珠圖憶起看，在事件 <code>a</code> 時間點時，輸入內容超過 3 個字，因此預期的 Observable 會得到這個資料，而事件 <code>b</code> 時間點指輸入 2 個字，因此在新的 Observable 上沒有事件發生。同時考量到整個 operator 有一個 <code>debounceTime(300)</code>，因此事件 <code>a</code> 發生後等待 <code>300ms</code> 沒有新事件才會在新的 Observable 上發生事件 <code>x</code>。</p>
<p>這裡的 <code>x</code> 實際上就是 <code>a</code> 事件，因此我們也可以把 <code>expectedResult</code> 的 <code>x</code> 直接取代成 <code>a</code>，比較時可以都傳入 <code>input</code> 會更好理解這個彈珠圖，這裡只是示範帶入不同物件的方法。</p>
<p>接著測試 <code>debounceTime(300)</code> 的行為：</p>
<pre><code class="language-typescript">it('300ms 內沒有的輸入才允許事件發生', () =&gt; {
  testScheduler.run((helpers) =&gt; {
    const { cold, expectObservable } = helpers;
    const input = {
      a: 'rxjs-demo',
      b: 'rxjs-test',
      c: 'rxjs',
    };

    // a--b 後等待 100ms 繼續輸入文字 (事件 c)，因為沒超過 300ms 所以沒有新事件
    // 之後 300ms 沒有新的輸入，將最後資料當作事件發送
    const sourceMarbleDiagram = 'a--b 100ms c';
    const expectedResult =      '---- 100ms 300ms c';

    const sourceObservable = cold(sourceMarbleDiagram, input);
    const source$ = sourceObservable.pipe(debounceInput());
    expectObservable(source$).toBe(expectedResult, input);
  });
});
</code></pre>
<p>考量到 <code>filter(data =&gt; data.length &gt;= 3)</code> 的條件，我們將事件內容都設定超過 3 個字，而事件 <code>a</code>、<code>b</code> 和 <code>c</code> 之間的間隔都沒有超過設定的 <code>300ms</code> 因此過程中不會有新的事件，直到事件 <code>c</code> 發生後 <code>300ms</code> 沒有新事件，才在新的 Observable 發生來源 Observable 的最後一個事件值 <code>c</code>。</p>
<p>最後測試 <code>distinceUntilChanged</code> 的行為：</p>
<pre><code class="language-typescript">it('事件值跟上次相同時，不允許本次事件發生', () =&gt; {
  testScheduler.run((helpers) =&gt; {
    const { cold, expectObservable } = helpers;

    const input = {
      a: 'rxj',
      b: 'rxjs',
      c: 'rxjs',
      d: 'rxj',
    };

    // 由於 b 事件跟 c 事件的內容一樣，因此事件不會發生
    // 由於 c 事件跟 d 事件的內容不同，因此事件繼續發生
    // 若使用 distinct 則會因為 a 和 d 事件一樣而不發生新事件
    const sourceMarbleDiagram = 'a 300ms   b 300ms   c 300ms d';
    const expectedResult =      '  300ms a   300ms b - 300ms   300ms d';

    const sourceObservable = cold(sourceMarbleDiagram, input);
    const source$ = sourceObservable.pipe(debounceInput());
    expectObservable(source$).toBe(expectedResult, input);
  });
});
</code></pre>
<p>一樣的需要考量到 <code>debounce(300)</code> 和 <code>filter(data =&gt; data.length &gt;= 3)</code> 的問題；事件 <code>a</code> 發生後 <code>300ms</code> 發生在新的 Observable 上，事件 <code>b</code> 也是；而事件 <code>c</code> 和事件 <code>b</code> 內容相同，因此不會發生在新的 Observable 上。</p>
<h1 id="本日小結">本日小結</h1>
<p>今天我們學習到兩種測試 RxJS 的方法</p>
<ul>
<li>直接在 <code>subscribe</code> callback 內驗證：直覺簡單，但比較不能應付複雜情境，非同步程式的測試可能會拉長整體測試時間</li>
<li>使用彈珠圖測試 (Marble Testing)：使用 TestScheduler；前置步驟比較多，但可以畫出彈珠圖來以視覺畫的方式進行測試，同時可以把所以非同步程式都當作同步程式來測試，效能會更好</li>
</ul>
<p>如果 Observable 真的很簡單，可以考慮使用 <code>subscribe</code> callback 的方法就好，如果遇到比較複雜的狀況，RxJS 都幫我們想好了，使用 TestScheduler 可以幫助我們用很好理解的方式撰寫測試程式囉！</p>
<h1 id="相關資源">相關資源</h1>
<ul>
<li><a href="https://rxjs-dev.firebaseapp.com/guide/testing/marble-testing">Marble Testing</a></li>
<li><a href="https://rxjs-dev.firebaseapp.com/api/testing/TestScheduler">TestScheduler</a></li>
</ul>
<h1 id="完賽感言">完賽感言</h1>
<p>終於！把我覺得 RxJS 想介紹的內容都寫完了！！希望這 35 篇內容可以幫助大家由淺入深的理解 RxJS，同時體會到它的強大、便利以及可靠。雖然 RxJS 真的是一個比較抽象的東西，但只要花點時間多多練習這些內容，相信一定可以幫助大家打通 RxJS 任督二脈，搖身一變成高手啦！</p>
<p>RxJS 還有很多 operators 沒機會介紹到，之後我會再花些時間整理這些 operators，以及補上更多實戰練習，這部分就敬請期待囉。</p>
</div><div _ngcontent-sc130="" class="blog-post-tags"><mat-chip-list _ngcontent-sc130="" aria-label="Post Tags" class="mat-chip-list" id="mat-chip-list-25" tabindex="0" aria-required="false" aria-disabled="false" aria-invalid="false" aria-multiselectable="false" role="listbox" aria-orientation="horizontal"><div class="mat-chip-list-wrapper"><mat-chip _ngcontent-sc130="" role="option" color="primary" selected="" class="mat-chip mat-focus-indicator blog-post-tag mat-primary mat-standard-chip mat-chip-selected _mat-animation-noopable ng-star-inserted" tabindex="-1" aria-disabled="false" aria-selected="true"><div class="mat-chip-ripple"></div> RxJS </mat-chip><mat-chip _ngcontent-sc130="" role="option" color="primary" selected="" class="mat-chip mat-focus-indicator blog-post-tag mat-primary mat-standard-chip mat-chip-selected _mat-animation-noopable ng-star-inserted" tabindex="-1" aria-disabled="false" aria-selected="true"><div class="mat-chip-ripple"></div> Testing </mat-chip><mat-chip _ngcontent-sc130="" role="option" color="primary" selected="" class="mat-chip mat-focus-indicator blog-post-tag mat-primary mat-standard-chip mat-chip-selected _mat-animation-noopable ng-star-inserted" tabindex="-1" aria-disabled="false" aria-selected="true"><div class="mat-chip-ripple"></div> Marble Diagrams </mat-chip><!----></div></mat-chip-list></div><mat-divider _ngcontent-sc130="" role="separator" class="mat-divider mat-divider-horizontal" aria-orientation="horizontal"></mat-divider><div _ngcontent-sc130="" class="blog-post-prev-next"><div _ngcontent-sc130="" class="blog-post-prev"><div _ngcontent-sc130="" class="blog-post-prev-next-notify prev ng-star-inserted"><mat-icon _ngcontent-sc130="" role="img" class="mat-icon notranslate material-icons mat-icon-no-color" aria-hidden="true" data-mat-icon-type="font">chevron_left</mat-icon> 上一篇 </div><a _ngcontent-sc130="" href="/blog/2020/10/20/mastering-rxjs-34-introduce-scheduler-of-rxjs" class="ng-star-inserted"> [RxJS] 認識 Scheduler </a><!----><!----><!----></div><div _ngcontent-sc130="" class="blog-post-next"><div _ngcontent-sc130="" class="blog-post-prev-next-notify next ng-star-inserted"> 下一篇 <mat-icon _ngcontent-sc130="" role="img" class="mat-icon notranslate material-icons mat-icon-no-color" aria-hidden="true" data-mat-icon-type="font">chevron_right</mat-icon></div><a _ngcontent-sc130="" href="/blog/2021/04/17/notes-for-rx-net" class="ng-star-inserted"> [C#] Rx.NET 筆記 (不定時更新) </a><!----><!----><!----></div><!----></div><mat-divider _ngcontent-sc130="" role="separator" class="mat-divider mat-divider-horizontal" aria-orientation="horizontal"></mat-divider><h1 _ngcontent-sc130="">有任何問題或建議嗎？歡迎留言給我</h1><div _ngcontent-sc130="" class="blog-post-comments"></div></div><!----></div><!----><!----></app-blog-post><!----><button _ngcontent-sc87="" mat-fab="" color="default" mattooltip="回到最上面" class="mat-focus-indicator go-top mat-fab mat-button-base mat-default _mat-animation-noopable"><span class="mat-button-wrapper"><mat-icon _ngcontent-sc87="" role="img" class="mat-icon notranslate material-icons mat-icon-no-color" aria-hidden="true" data-mat-icon-type="font">keyboard_double_arrow_up</mat-icon></span><span matripple="" class="mat-ripple mat-button-ripple mat-button-ripple-round"></span><span class="mat-button-focus-overlay"></span></button></div></app-blog-layout><!----></mat-drawer-content><!----></mat-drawer-container></app-root>
<script src="runtime.7ff58c590f5487bde224.js" defer=""></script><script src="polyfills.145163af39e593267dd4.js" defer=""></script><script src="main.4dee6e8b23e793363d55.js" defer=""></script>


</body><!-- This page was prerendered with Angular Universal --></html>