<mat-toolbar
  color="primary"
  class="toolbar mat-elevation-z6"
  xmlns="http://www.w3.org/1999/html"
>
  <button
    role="button"
    aria-label="打開/收合選單"
    mat-icon-button
    (click)="menuOpen$.next(!menuOpen$.value); cdr.detectChanges()"
  >
    <mat-icon *ngIf="menuOpen$ | async">menu_open</mat-icon>
    <mat-icon *ngIf="!(menuOpen$ | async)">menu</mat-icon>
  </button>
  <h1>
    <a class="header-link" routerLink="/">
      <span class="header-link">全端開發人員天梯</span>
    </a>
  </h1>

  <div class="spacer"></div>

  <button
    role="button"
    aria-label="深色/亮色模式"
    mat-icon-button
    (click)="theme$.next(theme$.value === 'light' ? 'dark' : 'light')"
  >
    <mat-icon *ngIf="(theme$ | async) === 'light'">light_mode</mat-icon>
    <mat-icon *ngIf="(theme$ | async) !== 'light'">dark_mode</mat-icon>
  </button>

  <div class="search-bar" *ngIf="!(isSmallScreen$ | async)">
    <input
      autocomplete="off"
      type="text"
      class="search-input"
      matInput
      accesskey="/"
      placeholder="搜尋... ( Alt + / )"
      #input
      (keyup.enter)="goSearchPage(auto); input.blur(); trigger.closePanel()"
      [formControl]="searchKeyword"
      [matAutocomplete]="auto"
      #trigger="matAutocompleteTrigger"
    />
    <mat-autocomplete
      #auto="matAutocomplete"
      panelWidth="auto"
      (optionSelected)="selectSuggestItem($event)"
    >
      <mat-option *ngFor="let item of suggestList$ | async" [value]="item">
        <span class="suggest-item-type">{{ item.type }}</span>
        <span class="suggest-item-text">{{ item.text }}</span>
      </mat-option>
    </mat-autocomplete>
  </div>
</mat-toolbar>

<mat-progress-bar *ngIf="pageLoading$ | async" mode="indeterminate" color="accent" class="!fixed top-0 z-50"></mat-progress-bar>

<mat-drawer-container class="drawer-container">
  <mat-drawer
    class="sidebar"
    [class.server-sidebar]="isServer"
    [mode]="(isSmallScreen$ | async) ? 'over' : 'side'"
    [disableClose]="(isSmallScreen$ | async) ? false : true"
    [opened]="menuOpen$ | async"
    (closed)="menuOpen$.next(false)"
  >
    <div class="post-statics">
      <div class="statics-block">
        <a routerLink="/blog/archives">
          <div class="counter">{{ postCount$ | async }}</div>
          <div class="description">文章</div>
        </a>
      </div>
      <div class="statics-block">
        <a routerLink="/blog/categories">
          <div class="counter">{{ categoryCount$ | async }}</div>
          <div class="description">分類</div>
        </a>
      </div>
      <div class="statics-block">
        <a routerLink="/blog/tags">
          <div class="counter">{{ tagCount$ | async }}</div>
          <div class="description">標籤</div>
        </a>
      </div>
    </div>

    <mat-divider></mat-divider>

    <div>
      <div class="section-title">好書推薦</div>
      <div class="section-content">
        <mat-nav-list>
          <a
            href="https://www.tenlong.com.tw/products/9789864348039"
            class="no-underline"
            target="_blank"
            rel="noreferrer"
            style="display: flex; flex-direction: column; align-items: center"
          >
            <img
              src="assets/promotion/rxjs.webp"
              width="160px"
              height="224px"
              alt="打通 RxJS 任督二脈 - 好評熱售中！"
              loading="lazy"
            />
            <div>打通 RxJS 任督二脈</div>
          </a>
        </mat-nav-list>
      </div>
    </div>

    <mat-divider></mat-divider>

    <mat-nav-list>
      <a
        *ngFor="let item of menuItems"
        mat-list-item
        routerLinkActive="active"
        [routerLinkActiveOptions]="{ exact: item.link === '/blog' }"
        [routerLink]="item.link"
      >
        <span class="flex flex-row">
          <mat-icon>{{ item.icon }}</mat-icon>
          <span class="link-text">{{ item.text }}</span>
        </span>
      </a>
    </mat-nav-list>

    <mat-divider></mat-divider>

    <mat-nav-list>
      <a mat-list-item href="/blog/atom.xml" target="_blank" rel="noreferrer">
        <span class="flex flex-row">
          <mat-icon>rss_feed</mat-icon>
          <span class="link-text">RSS</span>
        </span>
      </a>
      <a
        mat-list-item
        href="https://github.com/wellwind/"
        target="_blank"
        rel="noreferrer"
      >
        <span class="flex flex-row">
          <mat-icon fontSet="fontawesome" fontIcon="fa-github"></mat-icon>
          <span class="link-text">GitHub</span>
        </span>
      </a>
      <a
        mat-list-item
        href="https://www.facebook.com/fullstackledder"
        target="_blank"
        rel="noreferrer"
      >
        <span class="flex flex-row">
          <mat-icon fontSet="fontawesome" fontIcon="fa-facebook"></mat-icon>
          <span class="link-text">Facebook</span>
        </span>
      </a>
    </mat-nav-list>
  </mat-drawer>

  <mat-drawer-content
    class="main-content"
    [class.server]="isServer"
    #matDrawerContent
  >
    <router-outlet></router-outlet>
  </mat-drawer-content>
</mat-drawer-container>
